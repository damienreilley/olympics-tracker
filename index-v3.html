<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2026 Winter Olympics Bet Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#eef1f6;
  --card-hockey:#dbeafe;--card-medal:#fef9c3;--card-settled:#f1f5f9;
  --card-won:#d1fae5;--card-lost:#fee2e2;--card-live:#dbeafe;--card-dead:#f3f4f6;
  --border:#cbd5e1;--border-hockey:#93c5fd;--border-medal:#fcd34d;
  --win:#059669;--lose:#dc2626;--pending:#4f46e5;--live:#ea580c;--sweat:#d97706;--cold:#7c3aed;
  --text:#1e293b;--text2:#475569;--text3:#94a3b8;
  --gold:#d97706;--blue:#2563eb;--accent:#7c3aed;
  --header-bg:linear-gradient(135deg,#0f2a4a 0%,#1e3a5f 50%,#234876 100%);
  --module-bg:#fff;--analytics-bg:#f0f4ff;
}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh}
.app{max-width:1100px;margin:0 auto;padding:0 12px 40px}

/* HEADER */
.header{background:var(--header-bg);color:#fff;padding:18px 20px;border-radius:0 0 16px 16px;text-align:center;margin:0 -12px 14px;position:sticky;top:0;z-index:100;box-shadow:0 4px 20px rgba(0,0,0,.15)}
.header h1{font-family:'Oswald',sans-serif;font-size:1.7em;font-weight:700;letter-spacing:3px;text-shadow:0 2px 4px rgba(0,0,0,.2)}
.rings{display:flex;gap:4px;justify-content:center;margin-top:4px}
.rings span{width:12px;height:12px;border-radius:50%;border:2.5px solid}
.rings span:nth-child(1){border-color:#0081C8}.rings span:nth-child(2){border-color:#FCB131}
.rings span:nth-child(3){border-color:#e0e0e0}.rings span:nth-child(4){border-color:#00A651}
.rings span:nth-child(5){border-color:#EE334E}
.header-controls{display:flex;gap:6px;margin-top:10px;justify-content:center;flex-wrap:wrap;align-items:center}
.search-box{padding:6px 12px;border-radius:8px;border:1px solid rgba(96,165,250,.3);background:rgba(255,255,255,.1);color:#fff;font-size:.8em;width:200px;font-family:'DM Sans',sans-serif;backdrop-filter:blur(4px)}
.search-box::placeholder{color:rgba(255,255,255,.5)}
.search-box:focus{outline:none;border-color:#60a5fa;background:rgba(255,255,255,.15)}
.hdr-btn{padding:5px 12px;border-radius:8px;border:1px solid;cursor:pointer;font-family:'Oswald',sans-serif;font-size:.75em;letter-spacing:1px;transition:all .2s;background:transparent}
.hdr-btn.home{border-color:rgba(96,165,250,.5);color:#93bbfc}.hdr-btn.home:hover{background:#60a5fa;color:#fff}
.hdr-btn.refresh{border-color:rgba(251,191,36,.5);color:#fbbf24}.hdr-btn.refresh:hover{background:#fbbf24;color:#1e3a5f}
.hdr-btn.refresh.loading{opacity:.6;pointer-events:none}
.hdr-btn.add{border-color:rgba(52,211,153,.5);color:#34d399}.hdr-btn.add:hover{background:#34d399;color:#1e3a5f}
.auto-refresh-wrap{display:flex;align-items:center;gap:4px;font-size:.7em;color:rgba(255,255,255,.6)}
.auto-toggle{width:32px;height:18px;border-radius:9px;border:none;cursor:pointer;position:relative;transition:background .2s}
.auto-toggle.off{background:rgba(255,255,255,.2)}.auto-toggle.on{background:#34d399}
.auto-toggle::after{content:'';position:absolute;top:2px;left:2px;width:14px;height:14px;border-radius:50%;background:#fff;transition:left .2s}
.auto-toggle.on::after{left:16px}
@keyframes spin{to{transform:rotate(360deg)}}
.spin{display:inline-block;animation:spin 1s linear infinite}

/* SUMMARY */
.summary{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:6px;margin-bottom:12px}
.stat-card{background:var(--module-bg);border:1px solid var(--border);border-radius:10px;padding:8px 6px;text-align:center;box-shadow:0 1px 3px rgba(0,0,0,.04);transition:transform .15s}
.stat-card:hover{transform:translateY(-1px)}
.stat-card .val{font-family:'Oswald',sans-serif;font-size:1.4em;font-weight:600;line-height:1.1}
.stat-card .lbl{font-size:.6em;color:var(--text2);text-transform:uppercase;letter-spacing:.8px;margin-top:2px}
.v-green{color:var(--win)}.v-red{color:var(--lose)}.v-gold{color:var(--gold)}.v-blue{color:var(--pending)}.v-live{color:var(--live)}.v-purple{color:var(--accent)}

/* TOOLBAR */
.toolbar{display:flex;gap:6px;margin-bottom:10px;flex-wrap:wrap;align-items:center;background:var(--module-bg);padding:10px;border-radius:10px;border:1px solid var(--border);box-shadow:0 1px 3px rgba(0,0,0,.04)}
.toolbar-section{display:flex;gap:4px;flex-wrap:wrap;align-items:center}
.toolbar-label{font-size:.65em;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;font-weight:600;margin-right:2px}
.tab-btn{padding:4px 10px;border-radius:6px;border:1px solid var(--border);background:#f8fafc;color:var(--text2);cursor:pointer;font-size:.72em;font-family:'DM Sans',sans-serif;transition:all .15s;font-weight:500;white-space:nowrap}
.tab-btn:hover{border-color:var(--blue);color:var(--blue)}
.tab-btn.active{background:var(--blue);color:#fff;border-color:var(--blue)}
.sort-select,.type-select{padding:4px 8px;border-radius:6px;border:1px solid var(--border);background:#f8fafc;color:var(--text);font-size:.72em;font-family:'DM Sans',sans-serif;cursor:pointer}
.toolbar-divider{width:1px;height:24px;background:var(--border);margin:0 4px}

/* BET CARDS */
.bets-grid{display:flex;flex-direction:column;gap:8px}
.bet-card{border-radius:10px;overflow:hidden;transition:all .15s;border:2px solid}
.bet-card:hover{box-shadow:0 3px 12px rgba(0,0,0,.08)}
.bet-card.type-hockey{background:var(--card-hockey);border-color:var(--border-hockey)}
.bet-card.type-medal{background:var(--card-medal);border-color:var(--border-medal)}
.bet-card.status-lost{background:var(--card-lost);border-color:#fca5a5;opacity:.7}
.bet-card.status-won{background:var(--card-won);border-color:#6ee7b7}
.bet-card.status-dead{background:var(--card-dead);border-color:#d1d5db;opacity:.55}
.bet-card.status-dead .bet-title{text-decoration:line-through}

.bet-header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;cursor:pointer;gap:8px}
.bet-header:hover{opacity:.9}
.bet-left{display:flex;align-items:center;flex:1;min-width:0;gap:8px}
.bet-info{flex:1;min-width:0}
.bet-title{font-family:'Oswald',sans-serif;font-size:.9em;font-weight:500;color:var(--text);line-height:1.2}
.bet-meta{display:flex;gap:6px;margin-top:3px;font-size:.68em;color:var(--text2);flex-wrap:wrap;align-items:center}
.bet-right{text-align:right;flex-shrink:0}
.bet-odds{font-family:'Oswald',sans-serif;font-size:1.05em;font-weight:700;color:var(--gold)}
.bet-payout{font-size:.68em;color:var(--text2);margin-top:1px}

/* PROGRESS RING */
.progress-ring{width:38px;height:38px;flex-shrink:0}
.progress-ring circle{fill:none;stroke-width:3;stroke-linecap:round}
.ring-bg{stroke:#e2e8f0}.ring-fill{transition:stroke-dashoffset .4s ease}
.ring-text{font-family:'Oswald',sans-serif;font-size:9px;fill:var(--text);text-anchor:middle;dominant-baseline:central;font-weight:600}

/* STATUS BADGES */
.badge{display:inline-block;padding:2px 6px;border-radius:4px;font-size:.62em;font-weight:700;letter-spacing:.5px;text-transform:uppercase}
.badge-won{background:#065f46;color:#a7f3d0}
.badge-lost{background:#991b1b;color:#fecaca}
.badge-live{background:#c2410c;color:#fed7aa;animation:pulse 2s infinite}
.badge-pending{background:#3730a3;color:#c7d2fe}
.badge-dead{background:#57534e;color:#d6d3d1;text-decoration:line-through}
.badge-settled{background:#57534e;color:#d6d3d1}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}

/* EXPANDED DETAIL */
.bet-detail{display:none;padding:0 12px 12px}
.bet-card.expanded .bet-detail{display:block}
.dead-reason{background:#fef2f2;border:1px solid #fca5a5;border-radius:6px;padding:6px 10px;font-size:.75em;color:#991b1b;margin-bottom:8px}

/* LEGS TABLE - IMPROVED READABILITY */
.legs-list{margin-top:6px}
.leg-row{display:grid;grid-template-columns:1fr auto auto;align-items:center;padding:8px 10px;border-radius:6px;margin-bottom:3px;font-size:.8em;gap:8px}
.leg-row.leg-hit{background:rgba(5,150,105,.12);border:1px solid rgba(5,150,105,.25)}
.leg-row.leg-live{background:rgba(234,88,12,.08);border:1px solid rgba(234,88,12,.2)}
.leg-row.leg-sweat{background:rgba(217,119,6,.08);border:1px solid rgba(217,119,6,.2)}
.leg-row.leg-cold{background:rgba(124,58,237,.08);border:1px solid rgba(124,58,237,.2)}
.leg-row.leg-miss{background:rgba(220,38,38,.08);border:1px solid rgba(220,38,38,.2)}
.leg-row.leg-pending{background:rgba(255,255,255,.5);border:1px solid rgba(0,0,0,.06)}
.leg-row.leg-notstarted{background:rgba(255,255,255,.4);border:1px solid rgba(0,0,0,.04)}

.leg-name{font-weight:600;color:var(--text);line-height:1.3}
.leg-name small{font-weight:400;color:var(--text2);font-size:.85em}
.leg-progress-wrap{display:flex;align-items:center;gap:6px;justify-content:flex-end}
.leg-progress-text{font-family:'Oswald',sans-serif;font-size:.85em;font-weight:600;min-width:50px;text-align:right}
.lp-hit{color:var(--win)}.lp-live{color:var(--live)}.lp-sweat{color:var(--sweat)}.lp-cold{color:var(--cold)}.lp-miss{color:var(--lose)}.lp-pending{color:var(--text3)}
.leg-bar{width:50px;height:5px;background:#e2e8f0;border-radius:3px;overflow:hidden}
.leg-bar-fill{height:100%;border-radius:3px;transition:width .3s}
.bar-hit{background:var(--win)}.bar-live{background:var(--live)}.bar-sweat{background:var(--sweat)}.bar-cold{background:var(--cold)}.bar-miss{background:var(--lose)}.bar-pending{background:var(--text3)}

.leg-status-badge{font-size:.65em;font-weight:700;letter-spacing:.3px;padding:2px 6px;border-radius:3px;text-transform:uppercase;white-space:nowrap}
.lsb-hit{background:#065f46;color:#a7f3d0}.lsb-live{background:#c2410c;color:#fed7aa}.lsb-sweat{background:#92400e;color:#fde68a}
.lsb-cold{background:#5b21b6;color:#ddd6fe}.lsb-miss{background:#991b1b;color:#fecaca}.lsb-pending{background:#e2e8f0;color:#64748b}
.lsb-notstarted{background:#f1f5f9;color:#94a3b8}.lsb-winning{background:#065f46;color:#a7f3d0}.lsb-losing{background:#991b1b;color:#fecaca}.lsb-tied{background:#92400e;color:#fde68a}

/* GAME SCORE WIDGET */
.game-widget{background:var(--module-bg);border-radius:8px;padding:10px;margin-top:6px;border:1px solid var(--border)}
.game-score-row{display:flex;align-items:center;justify-content:center;gap:16px}
.team-score{text-align:center}
.team-score .name{font-family:'Oswald',sans-serif;font-size:.8em;color:var(--text2);letter-spacing:1px}
.team-score .score{font-family:'Oswald',sans-serif;font-size:2em;font-weight:700;color:var(--text)}
.game-info{text-align:center}
.game-status-text{font-size:.72em;font-weight:700;color:var(--live)}
.game-clock{font-size:.62em;color:var(--text3)}
.game-stats{display:grid;grid-template-columns:1fr 1fr;gap:4px;margin-top:8px;font-size:.7em}
.game-stat{display:flex;justify-content:space-between;background:#f8fafc;padding:3px 6px;border-radius:3px}
.game-stat .label{color:var(--text3)}.game-stat .value{color:var(--text);font-weight:600}
.scoring-plays{margin-top:8px;font-size:.7em}
.scoring-plays summary{cursor:pointer;color:var(--text2);font-weight:600;font-size:.85em}
.scoring-play{padding:3px 0;border-bottom:1px solid #f1f5f9;color:var(--text2)}

/* ANALYTICS PANEL */
.analytics{background:var(--analytics-bg);border:1px solid #bfdbfe;border-radius:10px;padding:14px;margin-bottom:14px;display:none}
.analytics.show{display:block}
.analytics h3{font-family:'Oswald',sans-serif;font-size:1em;color:var(--text);margin-bottom:10px;letter-spacing:1px}
.analytics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
.analytics-card{background:var(--module-bg);border-radius:8px;padding:10px;border:1px solid var(--border)}
.analytics-card h4{font-size:.75em;color:var(--text2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px}
.exposure-row{display:flex;justify-content:space-between;align-items:center;font-size:.78em;padding:2px 0;border-bottom:1px solid #f8fafc}
.exposure-bar{height:4px;background:#e2e8f0;border-radius:2px;margin-top:2px;overflow:hidden}
.exposure-fill{height:100%;background:var(--blue);border-radius:2px}

/* ADD BET MODAL */
.modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.4);z-index:200;justify-content:center;align-items:center;backdrop-filter:blur(2px)}
.modal-overlay.show{display:flex}
.modal{background:#fff;border-radius:14px;padding:24px;width:90%;max-width:520px;max-height:80vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.2)}
.modal h2{font-family:'Oswald',sans-serif;margin-bottom:14px;color:var(--text);letter-spacing:1px}
.modal label{display:block;font-size:.78em;font-weight:600;color:var(--text2);margin:8px 0 3px}
.modal input,.modal select,.modal textarea{width:100%;padding:7px 10px;border:1px solid var(--border);border-radius:6px;font-family:'DM Sans',sans-serif;font-size:.83em}
.modal textarea{height:80px;resize:vertical}
.modal-btns{display:flex;gap:8px;margin-top:14px}
.modal-btns button{flex:1;padding:10px;border-radius:8px;border:none;font-family:'Oswald',sans-serif;font-size:.9em;cursor:pointer;letter-spacing:1px}
.btn-save{background:var(--blue);color:#fff}.btn-cancel{background:#f1f5f9;color:var(--text)}
.btn-parse{background:var(--gold);color:#fff;margin-bottom:8px;width:100%;padding:8px;border-radius:6px;border:none;font-family:'Oswald',sans-serif;cursor:pointer;font-size:.8em;letter-spacing:.5px}

/* LAST UPDATED */
.last-updated{text-align:center;color:var(--text3);font-size:.7em;margin-top:14px}
.controls-row{display:flex;gap:6px;margin-bottom:8px;align-items:center;flex-wrap:wrap}
.controls-row button{padding:3px 10px;border-radius:5px;border:1px solid var(--border);background:var(--module-bg);color:var(--text2);cursor:pointer;font-size:.7em;font-family:'DM Sans',sans-serif;transition:all .15s}
.controls-row button:hover{border-color:var(--blue);color:var(--blue)}
.bet-count{margin-left:auto;font-size:.72em;color:var(--text3)}
.analytics-toggle{background:var(--analytics-bg)!important;border-color:#93c5fd!important;color:var(--blue)!important}

/* MOBILE */
@media(max-width:600px){
  .header h1{font-size:1.3em;letter-spacing:2px}
  .summary{grid-template-columns:repeat(3,1fr)}
  .search-box{width:150px;font-size:.75em}
  .toolbar{padding:8px}
  .bet-title{font-size:.82em}
  .header-controls{gap:4px}
  .hdr-btn{padding:4px 8px;font-size:.7em}
  .analytics-grid{grid-template-columns:1fr}
  .leg-row{grid-template-columns:1fr auto}
  .leg-bar{display:none}
}
</style>
</head>
<body>
<div class="app" id="app">

<!-- HEADER -->
<div class="header">
  <h1>üèî MILANO CORTINA 2026</h1>
  <div class="rings"><span></span><span></span><span></span><span></span><span></span></div>
  <div class="header-controls">
    <input type="text" class="search-box" id="searchBox" placeholder="üîç Search player, event..." oninput="applyFilters()">
    <button class="hdr-btn home" onclick="resetAll()">üè† HOME</button>
    <button class="hdr-btn refresh" id="refreshBtn" onclick="refreshData()">‚Üª REFRESH</button>
    <button class="hdr-btn add" onclick="showAddModal()">+ ADD BET</button>
    <div class="auto-refresh-wrap">
      <button class="auto-toggle off" id="autoToggle" onclick="toggleAutoRefresh()"></button>
      <span>Auto</span>
    </div>
  </div>
</div>

<!-- SUMMARY -->
<div class="summary" id="summary"></div>

<!-- TOOLBAR -->
<div class="toolbar">
  <div class="toolbar-section">
    <span class="toolbar-label">Status:</span>
    <button class="tab-btn active" data-filter="all">All</button>
    <button class="tab-btn" data-filter="active">‚ö° Live</button>
    <button class="tab-btn" data-filter="pending">üìÖ Pending</button>
    <button class="tab-btn" data-filter="settled">üìã Settled</button>
    <button class="tab-btn" data-filter="won">‚úÖ Won</button>
    <button class="tab-btn" data-filter="lost">‚ùå Lost</button>
  </div>
  <div class="toolbar-divider"></div>
  <div class="toolbar-section">
    <span class="toolbar-label">Sport:</span>
    <button class="tab-btn" data-filter="hockey">üèí Hockey</button>
    <button class="tab-btn" data-filter="medal">üèÖ Futures</button>
  </div>
  <div class="toolbar-divider"></div>
  <div class="toolbar-section">
    <span class="toolbar-label">Type:</span>
    <select class="type-select" id="typeSelect" onchange="applyFilters()">
      <option value="all">All Types</option>
      <option value="sgp">SGP</option>
      <option value="correct_score">Correct Score</option>
      <option value="futures">Futures</option>
    </select>
  </div>
  <select class="sort-select" id="sortSelect" onchange="applyFilters()" style="margin-left:auto">
    <option value="status">Sort: Status</option>
    <option value="payout-desc">Payout ‚Üì</option>
    <option value="payout-asc">Payout ‚Üë</option>
    <option value="odds-desc">Odds ‚Üì</option>
    <option value="odds-asc">Odds ‚Üë</option>
    <option value="wager-desc">Wager ‚Üì</option>
    <option value="legs-desc">Legs Hit ‚Üì</option>
    <option value="legs-pct">Legs % ‚Üì</option>
    <option value="legs-progress">Leg Progress ‚Üì</option>
  </select>
</div>

<!-- CONTROLS ROW -->
<div class="controls-row">
  <button onclick="expandAll()">‚Üï Expand All</button>
  <button onclick="collapseAll()">‚Üï Collapse All</button>
  <button class="analytics-toggle" onclick="toggleAnalytics()">üìä Analytics</button>
  <span class="bet-count" id="betCount"></span>
</div>

<!-- ANALYTICS PANEL -->
<div class="analytics" id="analyticsPanel">
  <h3>üìä ANALYTICS & EXPOSURE</h3>
  <div class="analytics-grid" id="analyticsGrid"></div>
</div>

<!-- BET GRID -->
<div class="bets-grid" id="betsGrid"></div>
<div class="last-updated" id="lastUpdated"></div>
</div>

<!-- ADD BET MODAL -->
<div class="modal-overlay" id="addModal">
<div class="modal">
  <h2>ADD NEW BET</h2>
  <label>Paste FanDuel Text (auto-parse)</label>
  <textarea id="pasteArea" placeholder="Paste full FanDuel bet text here..."></textarea>
  <button class="btn-parse" onclick="parseFanDuelText()">‚ö° AUTO-PARSE</button>
  <hr style="border:none;border-top:1px solid var(--border);margin:10px 0">
  <label>Event</label>
  <input id="newEvent" placeholder="e.g. Germany @ USA, Women's Slalom">
  <label>Type</label>
  <select id="newType"><option value="hockey">Hockey</option><option value="medal">Medal/Futures</option></select>
  <label>Market</label>
  <input id="newMarket" placeholder="e.g. SGP, 60 Min Correct Score, Gold Medal Winner">
  <label>Pick</label>
  <input id="newPick" placeholder="e.g. USA 6-2, Martina Peterlini (ITA)">
  <label>Odds</label>
  <input id="newOdds" placeholder="e.g. +1700">
  <label>Wager</label>
  <input id="newWager" placeholder="e.g. 0.10" value="0.10">
  <label>Legs (one per line, for SGPs)</label>
  <textarea id="newLegs" placeholder="Matthews 2+ SOG&#10;Tkachuk ATGS&#10;USA ML"></textarea>
  <label>Event Date (for futures)</label>
  <input id="newDate" placeholder="e.g. Tue 11:00am ET">
  <div class="modal-btns">
    <button class="btn-cancel" onclick="hideAddModal()">CANCEL</button>
    <button class="btn-save" onclick="saveBet()">SAVE BET</button>
  </div>
</div>
</div>

<script>
// ===== BET DATA (structured legs with player/prop/target/current/status) =====
let BETS = [
// === SETTLED HOCKEY ===
// France @ Canada (Final: CAN 10-2 FRA)
{id:"s01",type:"hockey",status:"lost",event:"France @ Canada",market:"correct_score",pick:"Canada 6-0",odds:"+1200",wager:0.10,payout:0,result:"CAN 10‚Äì2 FRA",gameId:"401845675"},
{id:"s02",type:"hockey",status:"lost",event:"France @ Canada",market:"correct_score",pick:"Canada 7-1",odds:"+1700",wager:0.10,payout:0,result:"CAN 10‚Äì2 FRA",gameId:"401845675"},
{id:"s03",type:"hockey",status:"lost",event:"France @ Canada",market:"correct_score",pick:"France 4-2",odds:"+40000",wager:0.10,payout:0,result:"CAN 10‚Äì2 FRA",gameId:"401845675"},
{id:"s04",type:"hockey",status:"lost",event:"France @ Canada",market:"sgp",pick:"OT Yes + France ML",odds:"+8323",wager:0.10,payout:0,result:"CAN 10‚Äì2 FRA",gameId:"401845675",
  legs:[{desc:"Yes OT",status:"miss"},{desc:"France ML",status:"miss"}]},
{id:"s05",type:"hockey",status:"lost",event:"France @ Canada",market:"sgp",pick:"OT Yes + France ML + Under 6.5",odds:"+7970",wager:0.10,payout:0,result:"CAN 10‚Äì2 FRA",gameId:"401845675",
  legs:[{desc:"Yes OT",status:"miss"},{desc:"France ML",status:"miss"},{desc:"Under 6.5 Goals",status:"miss"}]},
// Denmark @ USA (Final: USA 6-3 DEN)
{id:"s06",type:"hockey",status:"lost",event:"Denmark @ USA",market:"correct_score",pick:"USA 5-0",odds:"+1600",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676"},
{id:"s07",type:"hockey",status:"lost",event:"Denmark @ USA",market:"correct_score",pick:"USA 6-0",odds:"+1800",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676"},
{id:"s08",type:"hockey",status:"lost",event:"Denmark @ USA",market:"correct_score",pick:"USA 7-0",odds:"+2500",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676"},
{id:"s09",type:"hockey",status:"lost",event:"Denmark @ USA",market:"correct_score",pick:"Tie 5-5",odds:"+17500",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676"},
{id:"s10",type:"hockey",status:"lost",event:"Denmark @ USA",market:"correct_score",pick:"USA 5-4",odds:"+12500",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676"},
{id:"s11",type:"hockey",status:"lost",event:"Denmark @ USA",market:"correct_score",pick:"Denmark 6-3",odds:"+40000",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676"},
{id:"s12",type:"hockey",status:"lost",event:"Denmark @ USA",market:"correct_score",pick:"USA 7-5",odds:"+30000",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676"},
{id:"s13",type:"hockey",status:"lost",event:"Denmark @ USA",market:"correct_score",pick:"USA 6-4",odds:"+10000",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676"},
{id:"s14",type:"hockey",status:"lost",event:"Denmark @ USA",market:"sgp",pick:"OT Yes + Denmark ML",odds:"+2345",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676",
  legs:[{desc:"Yes OT",status:"miss"},{desc:"Denmark ML",status:"miss"}]},
// Other settled hockey
{id:"s15",type:"hockey",status:"lost",event:"Italy @ Finland",market:"sgp",pick:"OT Yes + Italy ML",odds:"+3253",wager:0.10,payout:0,result:"Settled",
  legs:[{desc:"Yes OT",status:"miss"},{desc:"Italy ML",status:"miss"}]},
{id:"s16",type:"hockey",status:"lost",event:"Germany(W) @ Canada(W)",market:"sgp",pick:"OT+Germany W ML+Poulin Goal",odds:"+15385",wager:0.10,payout:0,result:"Settled",
  legs:[{desc:"Yes OT",status:"miss"},{desc:"Germany(W) ML",status:"miss"},{desc:"Poulin ATGS",status:"miss"}]},
{id:"s17",type:"hockey",status:"lost",event:"Italy @ Finland",market:"sgp",pick:"OT+Italy ML+No 1st 10min Goal",odds:"+6079",wager:0.10,payout:0,result:"Settled",
  legs:[{desc:"Yes OT",status:"miss"},{desc:"Italy ML",status:"miss"},{desc:"No 1P Goal 1st 10min",status:"miss"}]},
// Settled medal
{id:"s18",type:"medal",status:"lost",event:"Multi-Sport Parlay",market:"sgp",pick:"Silvestro+Baumgartner+Jackson",odds:"+23462200",wager:0.10,payout:0,result:"Jackson DNM",
  legs:[{desc:"Silvestro Monobob Gold",status:"pending"},{desc:"Baumgartner 2-Man Bob Gold",status:"pending"},{desc:"Erin Jackson 500m Gold",status:"miss"}]},
{id:"s19",type:"medal",status:"lost",event:"Women's Giant Slalom",market:"futures",pick:"Sofia Goggia (ITA)",odds:"+2500",wager:0.10,payout:0,result:"Brignone won; Goggia DNM"},
{id:"s20",type:"medal",status:"lost",event:"Women's Giant Slalom",market:"futures",pick:"Lara Della Mea (ITA)",odds:"+8000",wager:0.10,payout:0,result:"Brignone (ITA) won gold"},
{id:"s21",type:"medal",status:"lost",event:"Men's 12.5km Pursuit",market:"futures",pick:"Lukas Hofer (ITA)",odds:"+10000",wager:0.10,payout:0,result:"Settled"},
{id:"s22",type:"medal",status:"lost",event:"Men's 12.5km Pursuit",market:"futures",pick:"Campbell Wright (USA)",odds:"+10000",wager:0.10,payout:0,result:"Settled"},
// Latvia @ Denmark (Final: DEN 4-2 LAT)
{id:"s23",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"correct_score",pick:"Latvia 4-3",odds:"+2200",wager:0.22,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678"},
{id:"s24",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"correct_score",pick:"Denmark 4-3",odds:"+1200",wager:0.20,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678"},
{id:"s25",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"sgp",pick:"Olesen 2+ Goals+Vilmanis ATGS",odds:"+12341",wager:0.10,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678",
  legs:[{desc:"Nick Olesen 2+ Goals",status:"miss"},{desc:"Sandis Vilmanis ATGS",status:"miss"}]},
{id:"s26",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"sgp",pick:"Molgaard+Eller+Vilmanis ATGS",odds:"+41738",wager:0.10,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678",
  legs:[{desc:"Molgaard ATGS",status:"miss"},{desc:"Lars Eller ATGS",status:"miss"},{desc:"Vilmanis ATGS",status:"miss"}]},
{id:"s27",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"sgp",pick:"Tralmaks 2+ Goals+Eller ATGS",odds:"+8084",wager:0.10,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678",
  legs:[{desc:"Tralmaks 2+ Goals",status:"miss"},{desc:"Lars Eller ATGS",status:"miss"}]},
{id:"s28",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"sgp",pick:"Tralmaks+Eller+Ehlers+Girgensons",odds:"+34108",wager:0.10,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678",
  legs:[{desc:"Tralmaks ATGS",status:"miss"},{desc:"Eller ATGS",status:"miss"},{desc:"Ehlers 2+ Goals",status:"miss"},{desc:"Girgensons ATGS",status:"miss"}]},
{id:"s29",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"sgp",pick:"Aagaard 2++Tralmaks+Olesen 2+",odds:"+27427",wager:0.10,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678",
  legs:[{desc:"Aagaard 2+ Goals",status:"miss"},{desc:"Tralmaks ATGS",status:"miss"},{desc:"Olesen 2+ Goals",status:"miss"}]},
{id:"s30",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"sgp",pick:"Latvia ML+Tie 3-Way+Over 9.5",odds:"+4252",wager:0.10,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678",
  legs:[{desc:"Latvia ML",status:"miss"},{desc:"Tie 60min 3-Way",status:"miss"},{desc:"Over 9.5 Alt Goals",status:"miss"}]},
{id:"s31",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"correct_score",pick:"Denmark 7-3",odds:"+3500",wager:0.15,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678"},
{id:"s32",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"correct_score",pick:"Any Other Score",odds:"+2500",wager:0.50,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678"},

// === ACTIVE HOCKEY ‚Äî Germany @ USA (401845680) ===
{id:"a01",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"None 1st Goal + Germany ML",odds:"+26146",wager:0.10,payout:26.25,gameId:"401845680",
  legs:[{desc:"None 60min 1st Goal",type:"prop",status:"live"},{desc:"Germany ML",type:"ml",status:"live"}]},
{id:"a02",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"Matthews 2P SOG+ATGS+Tiffels 2P Goal",odds:"+7735",wager:0.10,payout:7.84,gameId:"401845680",
  legs:[{desc:"Matthews 2P 2+ SOG",player:"Auston Matthews",prop:"2P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Matthews ATGS",player:"Auston Matthews",prop:"ATGS",target:1,current:0,type:"stat",status:"live"},
    {desc:"Tiffels 2P Goal",player:"Daniel Tiffels",prop:"2P Goal",target:1,current:0,type:"stat",status:"live"}]},
{id:"a03",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"B.Tkachuk 3+ Pts+M.Tkachuk 2+ Pts+more",odds:"+27423",wager:0.10,payout:27.52,gameId:"401845680",
  legs:[{desc:"B.Tkachuk 3+ Points",player:"Brady Tkachuk",prop:"Points",target:3,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk 2+ Points",player:"Matthew Tkachuk",prop:"Points",target:2,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk 1st Goal",player:"Matthew Tkachuk",prop:"1st Goal",target:1,current:0,type:"prop",status:"live"},
    {desc:"Peterka 2+ SOG",player:"JJ Peterka",prop:"SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Hughes 2+ SOG",player:"Quinn Hughes",prop:"SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Eichel 4+ SOG",player:"Jack Eichel",prop:"SOG",target:4,current:0,type:"stat",status:"live"},
    {desc:"Matthews 3+ SOG",player:"Auston Matthews",prop:"SOG",target:3,current:0,type:"stat",status:"live"},
    {desc:"B.Tkachuk 3+ SOG",player:"Brady Tkachuk",prop:"SOG",target:3,current:0,type:"stat",status:"live"}]},
{id:"a04",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"B.Tkachuk 3+ Goals+M.Tkachuk 3+ Pts",odds:"+11822",wager:0.10,payout:11.92,gameId:"401845680",
  legs:[{desc:"B.Tkachuk 3+ Goals",player:"Brady Tkachuk",prop:"Goals",target:3,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk 3+ Points",player:"Matthew Tkachuk",prop:"Points",target:3,current:0,type:"stat",status:"live"}]},
{id:"a05",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"M.Tkachuk 1st Goal+B.Tkachuk ATGS",odds:"+2184",wager:0.10,payout:2.28,gameId:"401845680",
  legs:[{desc:"M.Tkachuk 1st Goal",player:"Matthew Tkachuk",prop:"1st Goal",target:1,current:0,type:"prop",status:"live"},
    {desc:"B.Tkachuk ATGS",player:"Brady Tkachuk",prop:"ATGS",target:1,current:0,type:"stat",status:"live"}]},
{id:"a06",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"B.Tkachuk 1st Goal+M.Tkachuk 2+ Goals",odds:"+10697",wager:0.10,payout:10.80,gameId:"401845680",
  legs:[{desc:"B.Tkachuk 1st Goal",player:"Brady Tkachuk",prop:"1st Goal",target:1,current:0,type:"prop",status:"live"},
    {desc:"M.Tkachuk 2+ Goals",player:"Matthew Tkachuk",prop:"Goals",target:2,current:0,type:"stat",status:"live"}]},
{id:"a07",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"Points & SOG Mega Parlay (15 legs)",odds:"+13526",wager:0.10,payout:13.63,gameId:"401845680",
  legs:[{desc:"B.Tkachuk 1+ Pts",player:"Brady Tkachuk",prop:"Points",target:1,current:0,type:"stat",status:"live"},
    {desc:"Boldy 1P 1+ SOG",player:"Matt Boldy",prop:"1P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Boldy 3P 1+ SOG",player:"Matt Boldy",prop:"3P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk 2P 1+ SOG",player:"Matthew Tkachuk",prop:"2P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Werenski 2P 1+ SOG",player:"Zach Werenski",prop:"2P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Eichel 2P 2+ SOG",player:"Jack Eichel",prop:"2P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Eichel 2+ Pts",player:"Jack Eichel",prop:"Points",target:2,current:0,type:"stat",status:"live"},
    {desc:"Matthews 1+ Pts",player:"Auston Matthews",prop:"Points",target:1,current:0,type:"stat",status:"live"},
    {desc:"Draisaitl 1+ Pts",player:"Leon Draisaitl",prop:"Points",target:1,current:0,type:"stat",status:"live"},
    {desc:"Guentzel 3P 1+ SOG",player:"Jake Guentzel",prop:"3P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Boldy 2P 1+ SOG",player:"Matt Boldy",prop:"2P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk 3P 1+ SOG",player:"Matthew Tkachuk",prop:"3P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"B.Tkachuk 3P 1+ SOG",player:"Brady Tkachuk",prop:"3P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk 1P 1+ SOG",player:"Matthew Tkachuk",prop:"1P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk 2+ Pts",player:"Matthew Tkachuk",prop:"Points",target:2,current:0,type:"stat",status:"live"}]},
{id:"a08",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"Matthews+SOG+Eichel+Guentzel (10 legs)",odds:"+24973",wager:0.10,payout:25.07,gameId:"401845680",
  legs:[{desc:"Matthews 1P 2+ SOG",player:"Auston Matthews",prop:"1P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk 2P 1+ SOG",player:"Matthew Tkachuk",prop:"2P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Peterka 2P 1+ SOG",player:"JJ Peterka",prop:"2P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Peterka 3P 1+ SOG",player:"JJ Peterka",prop:"3P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Draisaitl 3P 1+ SOG",player:"Leon Draisaitl",prop:"3P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Werenski 2P 2+ SOG",player:"Zach Werenski",prop:"2P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"B.Tkachuk 2P 1+ SOG",player:"Brady Tkachuk",prop:"2P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Eichel ATGS",player:"Jack Eichel",prop:"ATGS",target:1,current:0,type:"stat",status:"live"},
    {desc:"Draisaitl 1+ Pts",player:"Leon Draisaitl",prop:"Points",target:1,current:0,type:"stat",status:"live"},
    {desc:"Guentzel 2+ Pts",player:"Jake Guentzel",prop:"Points",target:2,current:0,type:"stat",status:"live"}]},
{id:"a09",type:"hockey",status:"active",event:"Germany @ USA",market:"correct_score",pick:"USA 7-1",odds:"+3000",wager:0.10,payout:3.10,gameId:"401845680"},
{id:"a10",type:"hockey",status:"active",event:"Germany @ USA",market:"correct_score",pick:"USA 6-2",odds:"+1700",wager:0.10,payout:1.80,gameId:"401845680"},
{id:"a11",type:"hockey",status:"active",event:"Germany @ USA",market:"correct_score",pick:"USA 6-0",odds:"+3500",wager:0.10,payout:3.60,gameId:"401845680"},
{id:"a12",type:"hockey",status:"active",event:"Germany @ USA",market:"correct_score",pick:"USA 6-5",odds:"+40000",wager:0.10,payout:40.10,gameId:"401845680"},
{id:"a13",type:"hockey",status:"active",event:"Germany @ USA",market:"correct_score",pick:"USA 7-0",odds:"+4000",wager:0.10,payout:4.10,gameId:"401845680"},
{id:"a14",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"Reichel ATGS+3P SOG plays",odds:"+13168",wager:0.10,payout:13.27,gameId:"401845680",
  legs:[{desc:"Reichel ATGS",player:"Lukas Reichel",prop:"ATGS",target:1,current:0,type:"stat",status:"live"},
    {desc:"Reichel 3P 2+ SOG",player:"Lukas Reichel",prop:"3P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Peterka 3P 2+ SOG",player:"JJ Peterka",prop:"3P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Seider 3P 3+ SOG",player:"Moritz Seider",prop:"3P SOG",target:3,current:0,type:"stat",status:"live"}]},
{id:"a15",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"Seider+Boldy+M.Tkachuk+more 3P SOG",odds:"+8456",wager:0.10,payout:8.56,gameId:"401845680",
  legs:[{desc:"Seider 3P 2+ SOG",player:"Moritz Seider",prop:"3P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Boldy 3P 2+ SOG",player:"Matt Boldy",prop:"3P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk ATGS",player:"Matthew Tkachuk",prop:"ATGS",target:1,current:0,type:"stat",status:"live"},
    {desc:"B.Tkachuk 3P 2+ SOG",player:"Brady Tkachuk",prop:"3P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Eichel 3P 1+ SOG",player:"Jack Eichel",prop:"3P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Draisaitl 3P 1+ SOG",player:"Leon Draisaitl",prop:"3P SOG",target:1,current:0,type:"stat",status:"live"}]},
{id:"a16",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"Seider ATGS+Draisaitl/Seider/Boldy 3P SOG",odds:"+12559",wager:0.10,payout:12.66,gameId:"401845680",
  legs:[{desc:"Seider ATGS",player:"Moritz Seider",prop:"ATGS",target:1,current:0,type:"stat",status:"live"},
    {desc:"Draisaitl 3P 2+ SOG",player:"Leon Draisaitl",prop:"3P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Seider 3P 3+ SOG",player:"Moritz Seider",prop:"3P SOG",target:3,current:0,type:"stat",status:"live"},
    {desc:"Boldy 3P 2+ SOG",player:"Matt Boldy",prop:"3P SOG",target:2,current:0,type:"stat",status:"live"}]},
{id:"a17",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"Seider 2P Goal+Seider 3P 3+ SOG",odds:"+8457",wager:0.10,payout:8.56,gameId:"401845680",
  legs:[{desc:"Seider 2P Goal",player:"Moritz Seider",prop:"2P Goal",target:1,current:0,type:"stat",status:"live"},
    {desc:"Seider 3P 3+ SOG",player:"Moritz Seider",prop:"3P SOG",target:3,current:0,type:"stat",status:"live"}]},
{id:"a18",type:"hockey",status:"active",event:"Germany @ USA",market:"correct_score",pick:"USA 4-0",odds:"+1000",wager:0.10,payout:1.10,gameId:"401845680"},
{id:"a19",type:"hockey",status:"active",event:"Germany @ USA",market:"correct_score",pick:"USA 3-1",odds:"+1900",wager:0.10,payout:2.00,gameId:"401845680"},
{id:"a20",type:"hockey",status:"active",event:"Germany @ USA",market:"correct_score",pick:"USA 5-1",odds:"+1000",wager:0.10,payout:1.10,gameId:"401845680"},
{id:"a21",type:"hockey",status:"active",event:"GER@USA + LAT@DEN",market:"sgp",pick:"Draisaitl SOG+3P Goal+Tralmaks 2+",odds:"+44350",wager:0.10,payout:44.45,
  legs:[{desc:"Draisaitl 1P 2+ SOG",player:"Leon Draisaitl",prop:"1P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Draisaitl 2P 2+ SOG",player:"Leon Draisaitl",prop:"2P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Draisaitl 3P Goal",player:"Leon Draisaitl",prop:"3P Goal",target:1,current:0,type:"stat",status:"live"},
    {desc:"Tralmaks 2+ Goals (LAT@DEN)",player:"Rihards Tralmaks",prop:"Goals",target:2,current:0,type:"stat",status:"miss"}],
  deadReason:"LAT@DEN game final: Tralmaks did not score 2+"},

// === PENDING MEDAL FUTURES ===
{id:"p01",type:"medal",status:"pending",event:"Women's Slalom",market:"futures",pick:"Martina Peterlini (ITA) Medal",odds:"+6500",wager:0.10,payout:6.60,eventDate:"Tue 11:00am ET"},
{id:"p02",type:"medal",status:"pending",event:"Women's Slalom",market:"futures",pick:"Eliane Christen (SUI) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 11:00am ET"},
{id:"p03",type:"medal",status:"pending",event:"Women's Slalom",market:"futures",pick:"Lara Della Mea (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 11:00am ET"},
{id:"p04",type:"medal",status:"pending",event:"Women's Slalom",market:"futures",pick:"Caitlin McFarlane (FRA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 11:00am ET"},
{id:"p05",type:"medal",status:"pending",event:"Women's Slalom",market:"futures",pick:"Paula Moltzan (USA) Gold",odds:"+1800",wager:0.10,payout:1.90,eventDate:"Tue 11:00am ET"},
{id:"p06",type:"medal",status:"pending",event:"Women's Slopestyle",market:"futures",pick:"Lily Dhawornvej (USA) Gold",odds:"+6500",wager:0.16,payout:10.56,eventDate:"Tue 7:00am ET"},
{id:"p07",type:"medal",status:"pending",event:"Women's Slopestyle",market:"futures",pick:"Jessica Perlmutter (USA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 7:00am ET"},
{id:"p08",type:"medal",status:"pending",event:"2 Man Bobsleigh",market:"futures",pick:"Cedric Follador (SUI) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Mon 4:00am ET"},
{id:"p09",type:"medal",status:"pending",event:"2 Man Bobsleigh",market:"futures",pick:"Patrick Baumgartner (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Mon 4:00am ET"},
{id:"p10",type:"medal",status:"pending",event:"Women's Monobob",market:"futures",pick:"Simone De Silvestro (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Mon 4:00am ET"},
{id:"p11",type:"medal",status:"pending",event:"Women's Monobob",market:"futures",pick:"Giada Andreutti (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Mon 4:00am ET"},
{id:"p12",type:"medal",status:"pending",event:"Women's Figure Skating",market:"futures",pick:"Isabeau Levito (USA) Gold",odds:"+3300",wager:0.10,payout:3.40,eventDate:"Tue 12:45pm ET"},
{id:"p13",type:"medal",status:"pending",event:"Women's Figure Skating",market:"futures",pick:"Anna Pezzetta (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 12:45pm ET"},
{id:"p14",type:"medal",status:"pending",event:"Women's Figure Skating",market:"futures",pick:"Lara Naki Gutmann (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 12:45pm ET"},
{id:"p15",type:"medal",status:"pending",event:"Men's 1500m Speed Skating",market:"futures",pick:"Daniele Di Stefano (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Thu 10:30am ET"},
{id:"p16",type:"medal",status:"pending",event:"Men's Nordic Combined",market:"futures",pick:"Samuel Costa (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Mon 3:00am ET"},
{id:"p17",type:"medal",status:"pending",event:"Men's Slalom",market:"futures",pick:"Tobias Kastlunger (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Mon 11:00am ET"},
{id:"p18",type:"medal",status:"pending",event:"Men's Slalom",market:"futures",pick:"Benjamin Ritchie (USA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Mon 11:00am ET"},
{id:"p19",type:"medal",status:"pending",event:"Women's Slalom",market:"futures",pick:"Martina Peterlini (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 4:00am ET"},
{id:"p20",type:"medal",status:"pending",event:"Women's Slopestyle",market:"futures",pick:"Hahna Norman (USA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 8:15am ET"},
{id:"p21",type:"medal",status:"pending",event:"Women's Aerials",market:"futures",pick:"Tasia Tanner (USA) Gold",odds:"+6500",wager:0.10,payout:6.60,eventDate:"Tue 4:45am ET"},
{id:"p22",type:"medal",status:"pending",event:"Women's Ski Cross",market:"futures",pick:"Morgan Shute (USA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Fri 6:00am ET"},
{id:"p23",type:"medal",status:"pending",event:"Men's Ski Cross",market:"futures",pick:"Tyler Wallasch (USA) Gold",odds:"+8000",wager:0.10,payout:8.10,eventDate:"Sat 4:00am ET"},
{id:"p24",type:"medal",status:"pending",event:"Men's Aerials",market:"futures",pick:"Derek Krueger (USA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 7:30am ET"},
{id:"p25",type:"medal",status:"pending",event:"Men's Big Air",market:"futures",pick:"Miro Tabanelli (ITA) Gold",odds:"+5000",wager:0.10,payout:5.10,eventDate:"Sat 1:30pm ET"},
{id:"p26",type:"medal",status:"pending",event:"Men's Big Air",market:"futures",pick:"Konnor Ralph (USA) Gold",odds:"+5000",wager:0.10,payout:5.10,eventDate:"Sat 1:30pm ET"},
{id:"p27",type:"medal",status:"pending",event:"Women's Biathlon Mass Start",market:"futures",pick:"Lisa Theresa Hauser (AUT) Gold",odds:"+6500",wager:0.10,payout:6.60,eventDate:"Sat 8:45am ET"},
{id:"p28",type:"medal",status:"pending",event:"Women's Biathlon 4x6km Relay",market:"futures",pick:"Slovakia Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Wed 8:45am ET"},
{id:"p29",type:"medal",status:"pending",event:"Women's Biathlon 4x6km Relay",market:"futures",pick:"Austria Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Wed 8:45am ET"},
{id:"p30",type:"medal",status:"pending",event:"Women's Biathlon 4x6km Relay",market:"futures",pick:"United States Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Wed 8:45am ET"},
{id:"p31",type:"medal",status:"pending",event:"Women's Slalom",market:"futures",pick:"Martina Peterlini (ITA) Medal",odds:"+6500",wager:0.10,payout:6.60,eventDate:"Tue 4:00am ET"},
{id:"p32",type:"medal",status:"pending",event:"Women's Slalom",market:"futures",pick:"Martina Peterlini (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 4:00am ET"},
];

// Load user-added bets
try{const s=localStorage.getItem("olympics_user_bets");if(s)BETS.push(...JSON.parse(s))}catch(e){}

// ===== ESPN API =====
const ESPN_M="https://site.api.espn.com/apis/site/v2/sports/hockey/olympics-mens-ice-hockey";
const ESPN_W="https://site.api.espn.com/apis/site/v2/sports/hockey/olympics-womens-ice-hockey";
let liveGames={};
let playerStats={};
let scoringPlays={};

async function fetchHockeyScores(){
  try{
    const [m,w]=await Promise.all([
      fetch(ESPN_M+"/scoreboard").then(r=>r.json()).catch(()=>({events:[]})),
      fetch(ESPN_W+"/scoreboard").then(r=>r.json()).catch(()=>({events:[]}))
    ]);
    [...(m.events||[]),...(w.events||[])].forEach(ev=>{
      const c=ev.competitions?.[0];if(!c)return;
      const g={id:ev.id,name:ev.shortName,status:c.status?.type?.description||"Scheduled",
        clock:c.status?.displayClock||"",period:c.status?.period||0,teams:{},
        totalSOG:{}};
      (c.competitors||[]).forEach(t=>{
        const abbr=t.team?.abbreviation||"?";
        g.teams[abbr]={score:parseInt(t.score||0),abbr,name:t.team?.displayName,homeAway:t.homeAway};
        // Extract team stats if available
        if(t.statistics){
          t.statistics.forEach(s=>{
            if(s.abbreviation==="SOG")g.totalSOG[abbr]=parseInt(s.displayValue)||0;
          });
        }
      });
      liveGames[ev.id]=g;
    });
    // Fetch box scores for active games
    const activeGameIds=[...new Set(BETS.filter(b=>b.status==="active"&&b.gameId).map(b=>b.gameId))];
    for(const gid of activeGameIds){
      try{
        const [ms,ws]=await Promise.all([
          fetch(`${ESPN_M}/summary?event=${gid}`).then(r=>r.json()).catch(()=>null),
          fetch(`${ESPN_W}/summary?event=${gid}`).then(r=>r.json()).catch(()=>null)
        ]);
        const data=ms||ws;
        if(data){
          parseBoxScore(gid,data);
          parseScoringPlays(gid,data);
        }
      }catch(e){}
    }
  }catch(e){console.error("ESPN error:",e)}
}

function parseBoxScore(gid,data){
  if(!data.boxscore)return;
  const stats={};
  (data.boxscore.players||[]).forEach(team=>{
    (team.statistics||[]).forEach(statGroup=>{
      const labels=statGroup.labels||[];
      const gIdx=labels.indexOf("G"),aIdx=labels.indexOf("A"),sIdx=labels.indexOf("S"),ptsIdx=labels.indexOf("PTS");
      (statGroup.athletes||[]).forEach(ath=>{
        const name=ath.athlete?.displayName||"";
        const st=ath.stats||[];
        stats[name]={
          goals:parseInt(st[gIdx])||0,assists:parseInt(st[aIdx])||0,
          shots:parseInt(st[sIdx])||0,points:parseInt(st[ptsIdx])||0,
          name
        };
      });
    });
  });
  playerStats[gid]=stats;
}

function parseScoringPlays(gid,data){
  const plays=[];
  (data.plays||[]).forEach(p=>{
    if(p.scoringPlay||p.text?.includes("Goal")){
      plays.push({text:p.text||"",period:p.period?.number||0,clock:p.clock?.displayValue||""});
    }
  });
  scoringPlays[gid]=plays;
}

// ===== UPDATE LEG STATUS FROM LIVE DATA =====
function updateLegStatuses(){
  BETS.forEach(b=>{
    if(!b.legs||b.status==="won"||b.status==="lost")return;
    if(b.deadReason){b.status="dead";return}
    const gid=b.gameId;
    const game=liveGames[gid];
    const stats=playerStats[gid]||{};
    let anyMiss=false,allHit=true;

    b.legs.forEach(leg=>{
      if(leg.status==="miss"){anyMiss=true;allHit=false;return}
      if(!leg.player||!leg.target){
        // Non-stat legs (ML, OT, etc.) stay as-is unless settled
        if(b.status==="lost")leg.status="miss";
        if(leg.status!=="hit")allHit=false;
        return;
      }
      // Find player in stats
      const pStats=findPlayer(stats,leg.player);
      if(pStats){
        const current=getStatValue(pStats,leg.prop);
        leg.current=current;
        if(current>=leg.target){
          leg.status="hit";
        }else if(game&&(game.status==="Final"||game.status==="Final/OT")){
          leg.status="miss";anyMiss=true;allHit=false;
        }else{
          const pct=leg.target>0?current/leg.target:0;
          if(pct>=0.5)leg.status="live";
          else if(pct>=0.25)leg.status="sweat";
          else if(game&&game.status==="In Progress")leg.status="cold";
          else leg.status="notstarted";
          allHit=false;
        }
      }else{
        if(leg.status!=="hit")allHit=false;
      }
    });

    if(anyMiss)b.status="dead";
    // Check correct score bets against live score
    if(b.market==="correct_score"&&game){
      const scores=Object.values(game.teams);
      if(scores.length===2&&(game.status==="Final"||game.status==="Final/OT")){
        // Check if score matches pick
        b.status="lost";b.payout=0;
      }
    }
  });
}

function findPlayer(stats,name){
  if(!name)return null;
  // Exact match first
  if(stats[name])return stats[name];
  // Partial match
  const lower=name.toLowerCase();
  for(const[k,v]of Object.entries(stats)){
    if(k.toLowerCase().includes(lower)||lower.includes(k.toLowerCase().split(" ").pop()))return v;
  }
  return null;
}

function getStatValue(pStats,prop){
  if(!pStats||!prop)return 0;
  const p=prop.toLowerCase();
  if(p.includes("goal")||p==="atgs")return pStats.goals||0;
  if(p.includes("sog")||p.includes("shot"))return pStats.shots||0;
  if(p.includes("point")||p.includes("pts"))return pStats.points||0;
  if(p.includes("assist"))return pStats.assists||0;
  return 0;
}

// ===== STATE =====
let activeFilter="all";
let expandedBets=new Set();
let searchText="";
let autoRefreshInterval=null;

// ===== HELPERS =====
function oddsNum(s){return parseInt((s||"0").replace("+","").replace(",",""))||0}
function getLegCount(b){return b.legs?b.legs.length:0}
function getLegsHit(b){return b.legs?b.legs.filter(l=>l.status==="hit").length:0}
function getLegsPct(b){const t=getLegCount(b);return t?getLegsHit(b)/t:0}
function getAvgProgress(b){
  if(!b.legs)return 0;
  const tracked=b.legs.filter(l=>l.target&&l.target>0);
  if(!tracked.length)return 0;
  return tracked.reduce((s,l)=>s+Math.min((l.current||0)/l.target,1),0)/tracked.length;
}

function getCardClass(b){
  if(b.status==="won")return"status-won";
  if(b.status==="lost")return"status-lost";
  if(b.status==="dead"||b.deadReason)return"status-dead";
  return"type-"+b.type;
}

function getBadge(b){
  if(b.deadReason||b.status==="dead")return'<span class="badge badge-dead">‚ò† DEAD</span>';
  const m={won:"badge-won",lost:"badge-lost",active:"badge-live",live:"badge-live",pending:"badge-pending"};
  const l={won:"WON ‚úì",lost:"LOST",active:"LIVE",live:"LIVE",pending:"PENDING"};
  return`<span class="badge ${m[b.status]||'badge-settled'}">${l[b.status]||'SETTLED'}</span>`;
}

function getMarketLabel(m){
  return{sgp:"SGP",correct_score:"Correct Score",futures:"Futures"}[m]||m;
}

// ===== PROGRESS RING =====
function progressRingSVG(b){
  if(!b.legs||!b.legs.length)return"";
  const total=b.legs.length;
  const hit=getLegsHit(b);
  const r=14,circ=2*Math.PI*r;
  const pct=hit/total;
  const offset=circ*(1-pct);
  const color=pct===1?"var(--win)":pct>=0.5?"var(--live)":pct>0?"var(--sweat)":"var(--text3)";
  return`<svg class="progress-ring" viewBox="0 0 36 36">
    <circle class="ring-bg" cx="18" cy="18" r="${r}"/>
    <circle class="ring-fill" cx="18" cy="18" r="${r}" stroke="${color}" stroke-dasharray="${circ}" stroke-dashoffset="${offset}" transform="rotate(-90 18 18)"/>
    <text class="ring-text" x="18" y="18">${hit}/${total}</text>
  </svg>`;
}

// ===== LEG RENDERING =====
function renderLegsDetail(b){
  if(!b.legs||!b.legs.length)return"";
  let html='<div class="legs-list">';
  b.legs.forEach(leg=>{
    const ls=getLegStatusInfo(leg,b);
    html+=`<div class="leg-row ${ls.rowClass}">
      <div class="leg-name">${leg.desc}${leg.current!==undefined&&leg.target?` <small>(${leg.current}/${leg.target})</small>`:""}</div>
      <span class="leg-status-badge ${ls.badgeClass}">${ls.label}</span>
      ${leg.target?`<div class="leg-progress-wrap">
        <div class="leg-bar"><div class="leg-bar-fill ${ls.barClass}" style="width:${ls.pct}%"></div></div>
      </div>`:""}
    </div>`;
  });
  html+='</div>';
  return html;
}

function getLegStatusInfo(leg,bet){
  const s=leg.status||"pending";
  const pct=leg.target?(Math.min((leg.current||0)/leg.target,1)*100):0;
  const map={
    hit:{label:"‚úÖ HIT",rowClass:"leg-hit",badgeClass:"lsb-hit",barClass:"bar-hit",pct:100},
    miss:{label:"‚ùå MISS",rowClass:"leg-miss",badgeClass:"lsb-miss",barClass:"bar-miss",pct:pct},
    live:{label:"üîµ ON PACE",rowClass:"leg-live",badgeClass:"lsb-live",barClass:"bar-live",pct:pct},
    sweat:{label:"üü° SWEAT",rowClass:"leg-sweat",badgeClass:"lsb-sweat",barClass:"bar-sweat",pct:pct},
    cold:{label:"üü£ COLD",rowClass:"leg-cold",badgeClass:"lsb-cold",barClass:"bar-cold",pct:pct},
    notstarted:{label:"‚è≥ NOT STARTED",rowClass:"leg-notstarted",badgeClass:"lsb-notstarted",barClass:"bar-pending",pct:0},
    pending:{label:"‚è≥ AWAITING",rowClass:"leg-pending",badgeClass:"lsb-pending",barClass:"bar-pending",pct:0},
    winning:{label:"‚úÖ WINNING",rowClass:"leg-hit",badgeClass:"lsb-winning",barClass:"bar-hit",pct:100},
    losing:{label:"‚ùå LOSING",rowClass:"leg-miss",badgeClass:"lsb-losing",barClass:"bar-miss",pct:0},
    tied:{label:"üü° TIED",rowClass:"leg-sweat",badgeClass:"lsb-tied",barClass:"bar-sweat",pct:50},
  };
  return map[s]||map.pending;
}

// ===== GAME WIDGET =====
function getGameWidget(b){
  if(!b.gameId||!liveGames[b.gameId])return"";
  const g=liveGames[b.gameId];
  const abbrs=Object.keys(g.teams);
  if(abbrs.length<2)return"";
  const t1=g.teams[abbrs[0]],t2=g.teams[abbrs[1]];
  const statusLabel=g.status==="In Progress"?"LIVE":g.status;
  const plays=scoringPlays[b.gameId]||[];

  let html=`<div class="game-widget">
    <div class="game-score-row">
      <div class="team-score"><div class="name">${t1.abbr}</div><div class="score">${t1.score}</div></div>
      <div class="game-info">
        <div class="game-status-text">${statusLabel}</div>
        ${g.clock?`<div class="game-clock">${g.clock} P${g.period}</div>`:""}
      </div>
      <div class="team-score"><div class="name">${t2.abbr}</div><div class="score">${t2.score}</div></div>
    </div>`;

  // Team stats
  if(g.totalSOG&&Object.keys(g.totalSOG).length){
    html+=`<div class="game-stats">`;
    abbrs.forEach(a=>{
      if(g.totalSOG[a]!==undefined)html+=`<div class="game-stat"><span class="label">${a} SOG</span><span class="value">${g.totalSOG[a]}</span></div>`;
    });
    html+=`</div>`;
  }

  // Scoring plays
  if(plays.length){
    html+=`<details class="scoring-plays"><summary>‚ö° Scoring Plays (${plays.length})</summary>`;
    plays.forEach(p=>{
      html+=`<div class="scoring-play">P${p.period} ${p.clock} ‚Äî ${p.text.substring(0,120)}</div>`;
    });
    html+=`</details>`;
  }
  html+=`</div>`;
  return html;
}

// ===== FILTER & SORT =====
function filterBets(){
  let list=[...BETS];
  // Text search
  if(searchText){
    const q=searchText.toLowerCase();
    list=list.filter(b=>{
      const haystack=(b.pick+b.event+b.market+(b.legs||[]).map(l=>l.desc||l).join(" ")).toLowerCase();
      return haystack.includes(q);
    });
  }
  // Type select
  const typeFilter=document.getElementById("typeSelect").value;
  if(typeFilter!=="all"){
    list=list.filter(b=>b.market===typeFilter);
  }
  // Tab filter
  if(activeFilter!=="all"){
    list=list.filter(b=>{
      if(activeFilter==="hockey")return b.type==="hockey";
      if(activeFilter==="medal")return b.type==="medal";
      if(activeFilter==="active")return b.status==="active"||b.status==="live";
      if(activeFilter==="pending")return b.status==="pending";
      if(activeFilter==="settled")return b.status==="lost"||b.status==="won"||b.status==="dead";
      if(activeFilter==="won")return b.status==="won";
      if(activeFilter==="lost")return b.status==="lost"||b.status==="dead";
      return true;
    });
  }
  // Sort
  const sort=document.getElementById("sortSelect").value;
  const order={active:0,live:0,dead:1,pending:2,won:3,lost:4};
  if(sort==="status")list.sort((a,b)=>(order[a.status]??2)-(order[b.status]??2));
  else if(sort==="payout-desc")list.sort((a,b)=>b.payout-a.payout);
  else if(sort==="payout-asc")list.sort((a,b)=>a.payout-b.payout);
  else if(sort==="odds-desc")list.sort((a,b)=>oddsNum(b.odds)-oddsNum(a.odds));
  else if(sort==="odds-asc")list.sort((a,b)=>oddsNum(a.odds)-oddsNum(b.odds));
  else if(sort==="wager-desc")list.sort((a,b)=>b.wager-a.wager);
  else if(sort==="legs-desc")list.sort((a,b)=>getLegsHit(b)-getLegsHit(a));
  else if(sort==="legs-pct")list.sort((a,b)=>getLegsPct(b)-getLegsPct(a));
  else if(sort==="legs-progress")list.sort((a,b)=>getAvgProgress(b)-getAvgProgress(a));
  return list;
}

function applyFilters(){searchText=document.getElementById("searchBox").value;renderBets()}

// ===== RENDER =====
function renderSummary(){
  const total=BETS.length;
  const won=BETS.filter(b=>b.status==="won").length;
  const lost=BETS.filter(b=>b.status==="lost"||b.status==="dead").length;
  const active=BETS.filter(b=>b.status==="active"||b.status==="live").length;
  const pending=BETS.filter(b=>b.status==="pending").length;
  const dead=BETS.filter(b=>b.status==="dead"||b.deadReason).length;
  const wagered=BETS.reduce((s,b)=>s+b.wager,0);
  const returned=BETS.filter(b=>b.status==="won").reduce((s,b)=>s+b.payout,0);
  const potential=BETS.filter(b=>b.status!=="lost"&&b.status!=="won"&&b.status!=="dead").reduce((s,b)=>s+b.payout,0);
  const dream=BETS.filter(b=>b.status!=="lost"&&b.status!=="dead").reduce((s,b)=>s+b.payout,0);

  document.getElementById("summary").innerHTML=`
    <div class="stat-card"><div class="val">${total}</div><div class="lbl">Total Bets</div></div>
    <div class="stat-card"><div class="val v-live">${active}</div><div class="lbl">Live</div></div>
    <div class="stat-card"><div class="val v-blue">${pending}</div><div class="lbl">Pending</div></div>
    <div class="stat-card"><div class="val v-red">${lost}</div><div class="lbl">Lost</div></div>
    <div class="stat-card"><div class="val v-green">${won}</div><div class="lbl">Won</div></div>
    <div class="stat-card"><div class="val">$${wagered.toFixed(2)}</div><div class="lbl">Wagered</div></div>
    <div class="stat-card"><div class="val v-gold">$${potential.toFixed(2)}</div><div class="lbl">Potential</div></div>
    <div class="stat-card"><div class="val v-green">$${returned.toFixed(2)}</div><div class="lbl">Returned</div></div>
    <div class="stat-card"><div class="val v-purple">$${dream.toFixed(2)}</div><div class="lbl">üåü Dream</div></div>
  `;
}

function renderBets(){
  const filtered=filterBets();
  document.getElementById("betCount").textContent=`Showing ${filtered.length} of ${BETS.length} bets`;
  if(!filtered.length){
    document.getElementById("betsGrid").innerHTML='<div style="text-align:center;color:var(--text3);padding:40px">No bets match this filter</div>';
    return;
  }
  let html="";
  filtered.forEach(b=>{
    const exp=expandedBets.has(b.id);
    const hasLegs=b.legs&&b.legs.length>0;
    html+=`<div class="bet-card ${getCardClass(b)} ${exp?"expanded":""}" data-id="${b.id}">
      <div class="bet-header" onclick="toggleBet('${b.id}')">
        <div class="bet-left">
          ${hasLegs?progressRingSVG(b):""}
          <div class="bet-info">
            <div class="bet-title">${b.pick}</div>
            <div class="bet-meta">
              <span>${b.event}</span>
              <span>${getMarketLabel(b.market)}</span>
              ${b.eventDate?`<span>üìÖ ${b.eventDate}</span>`:""}
              ${getBadge(b)}
            </div>
          </div>
        </div>
        <div class="bet-right">
          <div class="bet-odds">${b.odds}</div>
          <div class="bet-payout">$${b.wager.toFixed(2)} ‚Üí $${b.payout.toFixed(2)}</div>
        </div>
      </div>
      <div class="bet-detail">
        ${b.deadReason?`<div class="dead-reason">‚ò† ${b.deadReason}</div>`:""}
        ${getGameWidget(b)}
        ${renderLegsDetail(b)}
        ${b.result?`<div style="margin-top:6px;font-size:.75em;color:var(--text2)">Result: ${b.result}</div>`:""}
      </div>
    </div>`;
  });
  document.getElementById("betsGrid").innerHTML=html;
}

// ===== ANALYTICS =====
function renderAnalytics(){
  const panel=document.getElementById("analyticsGrid");
  // Win rate by market
  const markets={};
  BETS.forEach(b=>{
    if(!markets[b.market])markets[b.market]={total:0,won:0,lost:0,wagered:0,returned:0};
    const m=markets[b.market];m.total++;m.wagered+=b.wager;
    if(b.status==="won"){m.won++;m.returned+=b.payout}
    if(b.status==="lost"||b.status==="dead")m.lost++;
  });

  // Player exposure
  const players={};
  BETS.forEach(b=>{
    if(!b.legs)return;
    b.legs.forEach(l=>{
      const name=l.player||l.desc;
      if(!name)return;
      if(!players[name])players[name]={count:0,payout:0};
      players[name].count++;
      players[name].payout+=b.payout/b.legs.length;
    });
  });
  const topPlayers=Object.entries(players).sort((a,b)=>b[1].count-a[1].count).slice(0,10);
  const maxCount=topPlayers.length?topPlayers[0][1].count:1;

  // Event exposure
  const events={};
  BETS.forEach(b=>{
    if(!events[b.event])events[b.event]={count:0,wagered:0,potential:0};
    events[b.event].count++;events[b.event].wagered+=b.wager;
    if(b.status!=="lost"&&b.status!=="dead")events[b.event].potential+=b.payout;
  });

  let html=`
  <div class="analytics-card">
    <h4>Win Rate by Market</h4>
    ${Object.entries(markets).map(([k,v])=>{
      const wr=v.total?((v.won/v.total)*100).toFixed(0):0;
      const roi=v.wagered?((v.returned-v.wagered)/v.wagered*100).toFixed(0):0;
      return`<div class="exposure-row"><span>${getMarketLabel(k)}</span><span>${v.won}/${v.total} (${wr}%) ROI:${roi}%</span></div>`;
    }).join("")}
  </div>
  <div class="analytics-card">
    <h4>Player Exposure (Top 10)</h4>
    ${topPlayers.map(([name,data])=>`
      <div class="exposure-row"><span style="font-size:.75em">${name}</span><span>${data.count} bets</span></div>
      <div class="exposure-bar"><div class="exposure-fill" style="width:${(data.count/maxCount*100)}%"></div></div>
    `).join("")}
  </div>
  <div class="analytics-card">
    <h4>Event Exposure</h4>
    ${Object.entries(events).sort((a,b)=>b[1].count-a[1].count).slice(0,8).map(([k,v])=>
      `<div class="exposure-row"><span style="font-size:.75em">${k}</span><span>${v.count} bets / $${v.potential.toFixed(2)}</span></div>`
    ).join("")}
  </div>`;
  panel.innerHTML=html;
}

// ===== ACTIONS =====
function toggleBet(id){expandedBets.has(id)?expandedBets.delete(id):expandedBets.add(id);renderBets()}
function expandAll(){BETS.forEach(b=>expandedBets.add(b.id));renderBets()}
function collapseAll(){expandedBets.clear();renderBets()}
function toggleAnalytics(){
  const p=document.getElementById("analyticsPanel");
  p.classList.toggle("show");
  if(p.classList.contains("show"))renderAnalytics();
}

function resetAll(){
  activeFilter="all";searchText="";
  document.getElementById("searchBox").value="";
  document.getElementById("sortSelect").value="status";
  document.getElementById("typeSelect").value="all";
  expandedBets.clear();
  document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
  document.querySelector('[data-filter="all"]').classList.add("active");
  document.getElementById("analyticsPanel").classList.remove("show");
  renderSummary();renderBets();
}

async function refreshData(){
  const btn=document.getElementById("refreshBtn");
  btn.classList.add("loading");btn.innerHTML='<span class="spin">‚Üª</span> REFRESHING...';
  await fetchHockeyScores();
  updateLegStatuses();
  renderSummary();renderBets();
  const now=new Date();
  document.getElementById("lastUpdated").textContent=`Last updated: ${now.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",timeZone:"America/New_York"})} ET`;
  btn.classList.remove("loading");btn.innerHTML='‚Üª REFRESH';
}

function toggleAutoRefresh(){
  const btn=document.getElementById("autoToggle");
  if(autoRefreshInterval){
    clearInterval(autoRefreshInterval);autoRefreshInterval=null;
    btn.className="auto-toggle off";
  }else{
    refreshData();
    autoRefreshInterval=setInterval(refreshData,45000);
    btn.className="auto-toggle on";
  }
}

// ===== ADD BET =====
function showAddModal(){document.getElementById("addModal").classList.add("show")}
function hideAddModal(){document.getElementById("addModal").classList.remove("show")}

function parseFanDuelText(){
  const text=document.getElementById("pasteArea").value.trim();
  if(!text){alert("Paste FanDuel text first");return}
  // Basic parsing - extract odds, pick info
  const oddsMatch=text.match(/[+-]\d{3,}/);
  if(oddsMatch)document.getElementById("newOdds").value=oddsMatch[0];
  // Try to extract legs
  const lines=text.split("\n").filter(l=>l.trim()&&!l.includes("Bet ID")&&!l.includes("Total Odds"));
  if(lines.length>2)document.getElementById("newLegs").value=lines.slice(0,-1).join("\n");
  alert("Parsed what I could ‚Äî review and fill in any missing fields");
}

function saveBet(){
  const evt=document.getElementById("newEvent").value.trim();
  const type=document.getElementById("newType").value;
  const market=document.getElementById("newMarket").value.trim()||"futures";
  const pick=document.getElementById("newPick").value.trim();
  const odds=document.getElementById("newOdds").value.trim();
  const wager=parseFloat(document.getElementById("newWager").value)||0.10;
  const legsText=document.getElementById("newLegs").value.trim();
  const eventDate=document.getElementById("newDate").value.trim();
  if(!evt||!pick||!odds){alert("Event, Pick, and Odds required");return}
  const ov=oddsNum(odds);
  const payout=wager*(1+ov/100);
  const legs=legsText?legsText.split("\n").filter(l=>l.trim()).map(l=>({desc:l.trim(),status:"pending"})):undefined;
  const marketType=legs&&legs.length>1?"sgp":type==="medal"?"futures":"correct_score";
  const newBet={
    id:"u"+Date.now(),type,status:"pending",event:evt,market:marketType,
    pick,odds:odds.startsWith("+")?odds:"+"+odds,
    wager,payout:parseFloat(payout.toFixed(2)),
    eventDate:eventDate||undefined,legs
  };
  BETS.push(newBet);
  try{const ub=BETS.filter(b=>b.id.startsWith("u"));localStorage.setItem("olympics_user_bets",JSON.stringify(ub))}catch(e){}
  hideAddModal();
  ["newEvent","newMarket","newPick","newOdds","newLegs","newDate"].forEach(id=>document.getElementById(id).value="");
  document.getElementById("newWager").value="0.10";
  document.getElementById("pasteArea").value="";
  renderSummary();renderBets();
}

// ===== TAB HANDLERS =====
document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    activeFilter=btn.dataset.filter;
    renderBets();
  });
});

// ===== INIT =====
(async function(){
  await fetchHockeyScores();
  updateLegStatuses();
  renderSummary();renderBets();
  const now=new Date();
  document.getElementById("lastUpdated").textContent=`Last updated: ${now.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",timeZone:"America/New_York"})} ET`;
})();
</script>
</body>
</html>
