<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ü•á 2026 Milano-Cortina Olympics Bet Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b1120;--surface:#131d33;--surface2:#1a2744;--border:#1e3a5f;
  --text:#e2e8f0;--text2:#94a3b8;--text3:#475569;
  --win:#22c55e;--lose:#ef4444;--live:#3b82f6;--sweat:#f59e0b;--cold:#8b5cf6;
  --gold:#fbbf24;--teal:#00d4aa;--blue:#3b82f6;
  --hockey:#1e3a5f;--medal:#7c3aed;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
.app{max-width:1200px;margin:0 auto;padding:8px}

/* HEADER */
.header{background:linear-gradient(135deg,#0f2a4a 0%,#1e3a5f 50%,#234876 100%);border-radius:12px;padding:14px 16px;margin-bottom:10px;position:sticky;top:0;z-index:100;box-shadow:0 4px 20px rgba(0,0,0,.4)}
.header h1{font-family:'Oswald',sans-serif;font-size:1.1em;color:var(--gold);text-transform:uppercase;letter-spacing:2px;text-align:center}
.header-controls{display:flex;gap:6px;margin-top:8px;flex-wrap:wrap;justify-content:center;align-items:center}
.search-box{flex:1;min-width:150px;max-width:300px;padding:6px 10px;border-radius:6px;border:1px solid var(--border);background:var(--surface);color:var(--text);font-size:.8em;font-family:'DM Sans',sans-serif}
.hdr-btn{padding:5px 12px;border-radius:6px;border:1px solid var(--border);cursor:pointer;font-size:.72em;font-family:'DM Sans',sans-serif;font-weight:600;transition:all .15s}
.hdr-btn.home{background:var(--surface);color:var(--gold);border-color:var(--gold)}
.hdr-btn.refresh{background:var(--teal);color:#000;border-color:var(--teal)}
.hdr-btn.add{background:var(--surface);color:var(--teal);border-color:var(--teal)}
.hdr-btn.analytics{background:var(--surface);color:#a855f7;border-color:#a855f7}
.auto-toggle{padding:4px 10px;border-radius:6px;border:1px solid var(--border);background:var(--surface);color:var(--text3);cursor:pointer;font-size:.68em}
.auto-toggle.on{background:var(--teal);color:#000;border-color:var(--teal)}
#lastUpdated{font-size:.65em;color:var(--text3);text-align:center;margin-top:4px}

/* SUMMARY DASHBOARD */
.summary{display:grid;grid-template-columns:repeat(auto-fit,minmax(90px,1fr));gap:6px;margin-bottom:10px}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:8px 6px;text-align:center}
.stat-label{font-size:.6em;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;font-weight:600}
.stat-val{font-family:'Oswald',sans-serif;font-size:1.1em;font-weight:700;color:var(--text);margin-top:2px}

/* TOOLBAR */
.toolbar{display:flex;gap:6px;margin-bottom:8px;flex-wrap:wrap;align-items:center;background:var(--surface);padding:8px 10px;border-radius:10px;border:1px solid var(--border)}
.toolbar-label{font-size:.68em;color:var(--text3);font-weight:600;white-space:nowrap}
.tab-btn{padding:4px 10px;border-radius:6px;border:1px solid var(--border);background:var(--surface2);color:var(--text2);cursor:pointer;font-size:.72em;font-family:'DM Sans',sans-serif;transition:all .15s;font-weight:500;white-space:nowrap}
.tab-btn:hover{border-color:var(--teal);color:var(--teal)}
.tab-btn.active{background:var(--teal);color:#000;border-color:var(--teal)}
.toolbar-divider{width:1px;height:20px;background:var(--border);margin:0 4px}
.sort-select{padding:4px 8px;border-radius:6px;border:1px solid var(--border);background:var(--surface2);color:var(--text2);font-size:.72em;font-family:'DM Sans',sans-serif}

/* COLLAPSIBLE SECTIONS */
.section{margin-bottom:16px;border-radius:12px;overflow:hidden}
.section-header{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;cursor:pointer;user-select:none;transition:background .15s}
.section-header:hover{filter:brightness(1.15)}
.section-header.hockey-sgp{background:linear-gradient(135deg,#0c2d48,#1a4a6c);border:2px solid #2a6a9a}
.section-header.correct-score{background:linear-gradient(135deg,#1a3c2a,#0d5f3c);border:2px solid #2a8a5a}
.section-header.medal-sgp{background:linear-gradient(135deg,#3d1b69,#5c2d95);border:2px solid #7a4abf}
.section-header.medal-futures{background:linear-gradient(135deg,#4a2c0a,#6b3d10);border:2px solid #c47f1a}
.section-title{font-family:'Oswald',sans-serif;font-size:1.1em;font-weight:700;color:#fff;letter-spacing:1px;text-transform:uppercase;display:flex;align-items:center;gap:8px}
.section-count{font-size:.75em;background:rgba(255,255,255,.2);padding:2px 10px;border-radius:10px;font-family:'DM Sans',sans-serif;font-weight:700}
.section-toggle{color:#fff;font-size:1.2em;transition:transform .2s}
.section-toggle.collapsed{transform:rotate(-90deg)}
.section-controls{display:flex;gap:6px;align-items:center}
.section-btn{padding:3px 10px;border-radius:4px;border:1px solid rgba(255,255,255,.3);background:rgba(255,255,255,.1);color:rgba(255,255,255,.8);cursor:pointer;font-size:.68em;font-family:'DM Sans',sans-serif;font-weight:700}
.section-btn:hover{background:rgba(255,255,255,.2)}
.section-body{padding:10px}
.section-body.collapsed{display:none}
.section-body.hockey-sgp-body{background:#0a1e30;border:1px solid #1a3a5f;border-top:0;border-radius:0 0 12px 12px}
.section-body.correct-score-body{background:#0a1e18;border:1px solid #1a4a3a;border-top:0;border-radius:0 0 12px 12px}
.section-body.medal-sgp-body{background:#15082e;border:1px solid #3a1e6a;border-top:0;border-radius:0 0 12px 12px}
.section-body.medal-futures-body{background:#1a1005;border:1px solid #4a3010;border-top:0;border-radius:0 0 12px 12px}

/* BET CARDS */
.bets-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
@media(max-width:900px){.bets-grid{grid-template-columns:1fr}}
.bet-card{background:var(--surface);border-radius:10px;border:1px solid var(--border);overflow:hidden;transition:all .15s}
.bet-card.won{border-color:var(--win);background:#0a2015}
.bet-card.lost{border-color:var(--lose);background:#1a0a0a;opacity:.7}
.bet-card.dead{border-color:var(--text3);background:#0d0d14;opacity:.5}
.bet-card.dead .bet-title{text-decoration:line-through}

/* BET HEADER */
.bet-header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;cursor:pointer;gap:10px}
.bet-header:hover{background:rgba(255,255,255,.03)}
.bet-left{display:flex;align-items:center;flex:1;min-width:0;gap:10px}
.bet-info{flex:1;min-width:0}
.bet-title{font-family:'Oswald',sans-serif;font-size:1em;font-weight:600;color:var(--text);line-height:1.2}
.bet-meta{display:flex;gap:6px;margin-top:4px;font-size:.72em;color:var(--text2);flex-wrap:wrap;align-items:center}
.bet-right{text-align:right;flex-shrink:0}
.bet-odds{font-family:'Oswald',sans-serif;font-size:1.15em;font-weight:700;color:var(--gold)}
.bet-payout{font-size:.72em;color:var(--text2);margin-top:2px}

/* STATUS BADGES */
.badge{display:inline-block;padding:2px 7px;border-radius:4px;font-size:.6em;font-weight:700;letter-spacing:.5px;text-transform:uppercase}
.badge-live{background:var(--live);color:#fff}
.badge-won{background:var(--win);color:#fff}
.badge-lost{background:var(--lose);color:#fff}
.badge-pending{background:var(--text3);color:#fff}
.badge-dead{background:#374151;color:#9ca3af}
.badge-active{background:var(--teal);color:#000}

/* EXPANDED DETAIL */
.bet-detail{padding:0 14px 12px;display:none}
.bet-detail.open{display:block}

/* PROGRESS RING */
.ring-wrap{position:relative;width:44px;height:44px;flex-shrink:0}
.ring-wrap svg{transform:rotate(-90deg)}
.ring-count{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-family:'Oswald',sans-serif;font-size:.8em;font-weight:700}

/* LEGS */
.legs-list{display:flex;flex-direction:column;gap:3px;margin-top:6px}
.leg-row{display:grid;grid-template-columns:1fr auto 90px;align-items:center;padding:9px 12px;border-radius:6px;font-size:.88em;gap:10px}
.leg-hit{background:rgba(34,197,94,.1);border-left:3px solid var(--win)}
.leg-miss{background:rgba(239,68,68,.1);border-left:3px solid var(--lose)}
.leg-live{background:rgba(59,130,246,.1);border-left:3px solid var(--live)}
.leg-sweat{background:rgba(245,158,11,.1);border-left:3px solid var(--sweat)}
.leg-cold{background:rgba(51,65,85,.2);border-left:3px solid #475569}
.leg-pending{background:rgba(30,41,59,.2);border-left:3px solid #334155}
.leg-name{font-weight:500;color:var(--text);overflow:hidden;text-overflow:ellipsis}
.leg-status-badge{font-size:.72em;font-weight:700;letter-spacing:.3px;padding:3px 8px;border-radius:4px;text-transform:uppercase;white-space:nowrap}
.lsb-hit{background:var(--win);color:#fff}
.lsb-miss{background:var(--lose);color:#fff}
.lsb-live{background:var(--blue);color:#fff}
.lsb-sweat{background:var(--sweat);color:#000}
.lsb-cold{background:#334155;color:#94a3b8}
.lsb-pending{background:#1e293b;color:#64748b}
.lsb-winning{background:var(--win);color:#fff}
.lsb-losing{background:var(--lose);color:#fff}
.lsb-tied{background:var(--sweat);color:#000}
.leg-bar{width:80px;height:8px;background:#1e293b;border-radius:4px;overflow:hidden}
.leg-bar-fill{height:100%;border-radius:4px;transition:width .3s}
.bar-hit{background:var(--win)}.bar-live{background:var(--blue)}.bar-sweat{background:var(--sweat)}.bar-cold{background:#475569}.bar-miss{background:var(--lose)}.bar-pending{background:#334155}

/* GAME WIDGET */
.game-widget{background:var(--surface2);border-radius:8px;padding:10px;margin-top:6px;border:1px solid var(--border)}
.game-score{display:flex;justify-content:center;align-items:center;gap:16px;padding:6px 0}
.game-team{text-align:center}
.game-team-abbr{font-family:'Oswald',sans-serif;font-size:.75em;font-weight:700;letter-spacing:2px;color:var(--text2)}
.game-team-score{font-family:'Oswald',sans-serif;font-size:2em;font-weight:800;color:#fff}
.game-status{text-align:center;font-size:.7em;font-weight:700}
.dead-reason{background:rgba(239,68,68,.15);border:1px solid rgba(239,68,68,.3);border-radius:6px;padding:6px 10px;margin-top:6px;font-size:.75em;color:var(--lose)}

/* ANALYTICS */
.analytics-panel{display:none;margin-bottom:10px}
.analytics-panel.show{display:block}
.analytics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:8px}
.analytics-card{background:var(--surface);border-radius:8px;padding:10px;border:1px solid var(--border)}
.analytics-card h3{font-family:'Oswald',sans-serif;font-size:.85em;color:var(--teal);margin-bottom:6px;text-transform:uppercase;letter-spacing:1px}

/* TOP LONGSHOTS */
.longshot-row{display:flex;justify-content:space-between;align-items:center;padding:6px 10px;border-radius:6px}
.longshot-row:nth-child(odd){background:var(--surface)}
.longshot-rank{font-size:.85em;font-weight:800;color:#a855f7;width:24px}
.longshot-payout{font-family:'Oswald',sans-serif;font-size:1em;font-weight:800;color:var(--gold)}

/* PLAYER EXPOSURE */
.exposure-bar-bg{flex:1;height:6px;background:var(--surface2);border-radius:3px;overflow:hidden}
.exposure-bar-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--teal),#22d3ee)}

/* MODAL */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:200;align-items:center;justify-content:center}
.modal-overlay.show{display:flex}
.modal{background:var(--surface);border-radius:12px;padding:20px;width:90%;max-width:500px;max-height:80vh;overflow-y:auto;border:1px solid var(--border)}

@media(max-width:600px){
  .bets-grid{grid-template-columns:1fr}
  .summary{grid-template-columns:repeat(3,1fr)}
  .toolbar{padding:6px}
  .bet-title{font-size:.88em}
  .header-controls{gap:4px}
  .hdr-btn{padding:4px 8px;font-size:.68em}
  .analytics-grid{grid-template-columns:1fr}
  .leg-row{grid-template-columns:1fr auto 60px}
  .leg-bar{width:50px;height:6px}
}
</style>
</head>
<body>
<div class="app" id="app">

<!-- HEADER -->
<div class="header">
  <h1>ü•á 2026 Milano-Cortina ¬∑ Olympics Tracker</h1>
  <div class="header-controls">
    <input type="text" class="search-box" id="searchBox" placeholder="üîç Search player, event..." oninput="applyFilters()">
    <button class="hdr-btn home" onclick="resetAll()">üè† HOME</button>
    <button class="hdr-btn refresh" id="refreshBtn" onclick="refreshData()">‚Üª REFRESH</button>
    <button class="hdr-btn add" onclick="showAddModal()">+ ADD BET</button>
    <button class="hdr-btn analytics" onclick="toggleAnalytics()">üìä STATS</button>
    <button class="auto-toggle" id="autoToggle" onclick="toggleAutoRefresh()"></button>
  </div>
  <div id="lastUpdated"></div>
</div>

<!-- SUMMARY -->
<div class="summary" id="summary"></div>

<!-- TOOLBAR -->
<div class="toolbar">
  <div style="display:flex;gap:4px;flex-wrap:wrap;align-items:center">
    <span class="toolbar-label">Status:</span>
    <button class="tab-btn" data-filter="all" onclick="setFilter('all',this)">All</button>
    <button class="tab-btn active" data-filter="active" onclick="setFilter('active',this)">‚ö° Active</button>
    <button class="tab-btn" data-filter="pending" onclick="setFilter('pending',this)">üìÖ Pending</button>
    <button class="tab-btn" data-filter="settled" onclick="setFilter('settled',this)">üìã Settled</button>
    <button class="tab-btn" data-filter="won" onclick="setFilter('won',this)">‚úÖ Won</button>
    <button class="tab-btn" data-filter="lost" onclick="setFilter('lost',this)">‚ùå Lost</button>
  </div>
  <div class="toolbar-divider"></div>
  <select class="sort-select" id="sortSelect" onchange="renderAll()">
    <option value="status">Sort: Status</option>
    <option value="payout-desc">Payout ‚Üì</option>
    <option value="payout-asc">Payout ‚Üë</option>
    <option value="odds-desc">Odds ‚Üì</option>
    <option value="odds-asc">Odds ‚Üë</option>
    <option value="wager-desc">Wager ‚Üì</option>
    <option value="legs-desc">Legs Hit ‚Üì</option>
    <option value="legs-pct">Legs % ‚Üì</option>
    <option value="legs-progress">Leg Progress ‚Üì</option>
  </select>
</div>

<!-- ANALYTICS -->
<div class="analytics-panel" id="analyticsPanel">
  <div class="analytics-grid" id="analyticsGrid"></div>
</div>

<!-- SECTIONS (rendered by JS) -->
<div id="sectionsContainer"></div>

<!-- ADD BET MODAL -->
<div class="modal-overlay" id="addModal">
  <div class="modal">
    <h3 style="font-family:Oswald;color:var(--gold);margin-bottom:12px">ADD NEW BET</h3>
    <div style="display:flex;flex-direction:column;gap:8px">
      <input id="mEvent" placeholder="Event (e.g. Germany @ USA)" style="padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--surface2);color:var(--text);font-size:.85em">
      <select id="mType" style="padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--surface2);color:var(--text);font-size:.85em">
        <option value="hockey">Hockey</option><option value="medal">Medal Futures</option>
      </select>
      <select id="mMarket" style="padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--surface2);color:var(--text);font-size:.85em">
        <option value="sgp">SGP</option><option value="correct_score">Correct Score</option><option value="futures">Futures</option>
      </select>
      <input id="mPick" placeholder="Pick / Description" style="padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--surface2);color:var(--text);font-size:.85em">
      <input id="mOdds" placeholder="Odds (e.g. +1700)" style="padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--surface2);color:var(--text);font-size:.85em">
      <input id="mWager" placeholder="Wager (e.g. 0.10)" type="number" step="0.01" style="padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--surface2);color:var(--text);font-size:.85em">
      <div style="display:flex;gap:8px;margin-top:4px">
        <button onclick="addBet()" style="flex:1;padding:8px;border-radius:6px;border:none;background:var(--teal);color:#000;font-weight:700;cursor:pointer">ADD</button>
        <button onclick="hideAddModal()" style="flex:1;padding:8px;border-radius:6px;border:1px solid var(--border);background:var(--surface);color:var(--text2);cursor:pointer">CANCEL</button>
      </div>
    </div>
  </div>
</div>

<script>
let BETS = [
// === SETTLED HOCKEY ===
// France @ Canada (Final: CAN 10-2 FRA)
{id:"s01",type:"hockey",status:"lost",event:"France @ Canada",market:"correct_score",pick:"Canada 6-0",odds:"+1200",wager:0.10,payout:0,result:"CAN 10‚Äì2 FRA",gameId:"401845675"},
{id:"s02",type:"hockey",status:"lost",event:"France @ Canada",market:"correct_score",pick:"Canada 7-1",odds:"+1700",wager:0.10,payout:0,result:"CAN 10‚Äì2 FRA",gameId:"401845675"},
{id:"s03",type:"hockey",status:"lost",event:"France @ Canada",market:"correct_score",pick:"France 4-2",odds:"+40000",wager:0.10,payout:0,result:"CAN 10‚Äì2 FRA",gameId:"401845675"},
{id:"s04",type:"hockey",status:"lost",event:"France @ Canada",market:"sgp",pick:"OT Yes + France ML",odds:"+8323",wager:0.10,payout:0,result:"CAN 10‚Äì2 FRA",gameId:"401845675",
  legs:[{desc:"Yes OT",status:"miss"},{desc:"France ML",status:"miss"}]},
{id:"s05",type:"hockey",status:"lost",event:"France @ Canada",market:"sgp",pick:"OT Yes + France ML + Under 6.5",odds:"+7970",wager:0.10,payout:0,result:"CAN 10‚Äì2 FRA",gameId:"401845675",
  legs:[{desc:"Yes OT",status:"miss"},{desc:"France ML",status:"miss"},{desc:"Under 6.5 Goals",status:"miss"}]},
// Denmark @ USA (Final: USA 6-3 DEN)
{id:"s06",type:"hockey",status:"lost",event:"Denmark @ USA",market:"correct_score",pick:"USA 5-0",odds:"+1600",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676"},
{id:"s07",type:"hockey",status:"lost",event:"Denmark @ USA",market:"correct_score",pick:"USA 6-0",odds:"+1800",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676"},
{id:"s08",type:"hockey",status:"lost",event:"Denmark @ USA",market:"correct_score",pick:"USA 7-0",odds:"+2500",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676"},
{id:"s09",type:"hockey",status:"lost",event:"Denmark @ USA",market:"correct_score",pick:"Tie 5-5",odds:"+17500",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676"},
{id:"s10",type:"hockey",status:"lost",event:"Denmark @ USA",market:"correct_score",pick:"USA 5-4",odds:"+12500",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676"},
{id:"s11",type:"hockey",status:"lost",event:"Denmark @ USA",market:"correct_score",pick:"Denmark 6-3",odds:"+40000",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676"},
{id:"s12",type:"hockey",status:"lost",event:"Denmark @ USA",market:"correct_score",pick:"USA 7-5",odds:"+30000",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676"},
{id:"s13",type:"hockey",status:"lost",event:"Denmark @ USA",market:"correct_score",pick:"USA 6-4",odds:"+10000",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676"},
{id:"s14",type:"hockey",status:"lost",event:"Denmark @ USA",market:"sgp",pick:"OT Yes + Denmark ML",odds:"+2345",wager:0.10,payout:0,result:"USA 6‚Äì3 DEN",gameId:"401845676",
  legs:[{desc:"Yes OT",status:"miss"},{desc:"Denmark ML",status:"miss"}]},
// Other settled hockey
{id:"s15",type:"hockey",status:"lost",event:"Italy @ Finland",market:"sgp",pick:"OT Yes + Italy ML",odds:"+3253",wager:0.10,payout:0,result:"Settled",
  legs:[{desc:"Yes OT",status:"miss"},{desc:"Italy ML",status:"miss"}]},
{id:"s16",type:"hockey",status:"lost",event:"Germany(W) @ Canada(W)",market:"sgp",pick:"OT+Germany W ML+Poulin Goal",odds:"+15385",wager:0.10,payout:0,result:"Settled",
  legs:[{desc:"Yes OT",status:"miss"},{desc:"Germany(W) ML",status:"miss"},{desc:"Poulin ATGS",status:"miss"}]},
{id:"s17",type:"hockey",status:"lost",event:"Italy @ Finland",market:"sgp",pick:"OT+Italy ML+No 1st 10min Goal",odds:"+6079",wager:0.10,payout:0,result:"Settled",
  legs:[{desc:"Yes OT",status:"miss"},{desc:"Italy ML",status:"miss"},{desc:"No 1P Goal 1st 10min",status:"miss"}]},
// Settled medal
{id:"s18",type:"medal",status:"lost",event:"Multi-Sport Parlay",market:"sgp",pick:"Silvestro+Baumgartner+Jackson",odds:"+23462200",wager:0.10,payout:0,result:"Jackson DNM",
  legs:[{desc:"Silvestro Monobob Gold",status:"pending"},{desc:"Baumgartner 2-Man Bob Gold",status:"pending"},{desc:"Erin Jackson 500m Gold",status:"miss"}]},
{id:"s19",type:"medal",status:"lost",event:"Women's Giant Slalom",market:"futures",pick:"Sofia Goggia (ITA)",odds:"+2500",wager:0.10,payout:0,result:"Brignone won; Goggia DNM"},
{id:"s20",type:"medal",status:"lost",event:"Women's Giant Slalom",market:"futures",pick:"Lara Della Mea (ITA)",odds:"+8000",wager:0.10,payout:0,result:"Brignone (ITA) won gold"},
{id:"s21",type:"medal",status:"lost",event:"Men's 12.5km Pursuit",market:"futures",pick:"Lukas Hofer (ITA)",odds:"+10000",wager:0.10,payout:0,result:"Settled"},
{id:"s22",type:"medal",status:"lost",event:"Men's 12.5km Pursuit",market:"futures",pick:"Campbell Wright (USA)",odds:"+10000",wager:0.10,payout:0,result:"Settled"},
// Latvia @ Denmark (Final: DEN 4-2 LAT)
{id:"s23",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"correct_score",pick:"Latvia 4-3",odds:"+2200",wager:0.22,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678"},
{id:"s24",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"correct_score",pick:"Denmark 4-3",odds:"+1200",wager:0.20,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678"},
{id:"s25",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"sgp",pick:"Olesen 2+ Goals+Vilmanis ATGS",odds:"+12341",wager:0.10,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678",
  legs:[{desc:"Nick Olesen 2+ Goals",status:"miss"},{desc:"Sandis Vilmanis ATGS",status:"miss"}]},
{id:"s26",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"sgp",pick:"Molgaard+Eller+Vilmanis ATGS",odds:"+41738",wager:0.10,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678",
  legs:[{desc:"Molgaard ATGS",status:"miss"},{desc:"Lars Eller ATGS",status:"miss"},{desc:"Vilmanis ATGS",status:"miss"}]},
{id:"s27",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"sgp",pick:"Tralmaks 2+ Goals+Eller ATGS",odds:"+8084",wager:0.10,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678",
  legs:[{desc:"Tralmaks 2+ Goals",status:"miss"},{desc:"Lars Eller ATGS",status:"miss"}]},
{id:"s28",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"sgp",pick:"Tralmaks+Eller+Ehlers+Girgensons",odds:"+34108",wager:0.10,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678",
  legs:[{desc:"Tralmaks ATGS",status:"miss"},{desc:"Eller ATGS",status:"miss"},{desc:"Ehlers 2+ Goals",status:"miss"},{desc:"Girgensons ATGS",status:"miss"}]},
{id:"s29",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"sgp",pick:"Aagaard 2++Tralmaks+Olesen 2+",odds:"+27427",wager:0.10,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678",
  legs:[{desc:"Aagaard 2+ Goals",status:"miss"},{desc:"Tralmaks ATGS",status:"miss"},{desc:"Olesen 2+ Goals",status:"miss"}]},
{id:"s30",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"sgp",pick:"Latvia ML+Tie 3-Way+Over 9.5",odds:"+4252",wager:0.10,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678",
  legs:[{desc:"Latvia ML",status:"miss"},{desc:"Tie 60min 3-Way",status:"miss"},{desc:"Over 9.5 Alt Goals",status:"miss"}]},
{id:"s31",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"correct_score",pick:"Denmark 7-3",odds:"+3500",wager:0.15,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678"},
{id:"s32",type:"hockey",status:"lost",event:"Latvia @ Denmark",market:"correct_score",pick:"Any Other Score",odds:"+2500",wager:0.50,payout:0,result:"DEN 4‚Äì2 LAT",gameId:"401845678"},

// === ACTIVE HOCKEY ‚Äî Germany @ USA (401845680) ===
{id:"a01",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"None 1st Goal + Germany ML",odds:"+26146",wager:0.10,payout:26.25,gameId:"401845680",
  legs:[{desc:"None 60min 1st Goal",type:"prop",status:"live"},{desc:"Germany ML",type:"ml",status:"live"}]},
{id:"a02",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"Matthews 2P SOG+ATGS+Tiffels 2P Goal",odds:"+7735",wager:0.10,payout:7.84,gameId:"401845680",
  legs:[{desc:"Matthews 2P 2+ SOG",player:"Auston Matthews",prop:"2P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Matthews ATGS",player:"Auston Matthews",prop:"ATGS",target:1,current:0,type:"stat",status:"live"},
    {desc:"Tiffels 2P Goal",player:"Daniel Tiffels",prop:"2P Goal",target:1,current:0,type:"stat",status:"live"}]},
{id:"a03",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"B.Tkachuk 3+ Pts+M.Tkachuk 2+ Pts+more",odds:"+27423",wager:0.10,payout:27.52,gameId:"401845680",
  legs:[{desc:"B.Tkachuk 3+ Points",player:"Brady Tkachuk",prop:"Points",target:3,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk 2+ Points",player:"Matthew Tkachuk",prop:"Points",target:2,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk 1st Goal",player:"Matthew Tkachuk",prop:"1st Goal",target:1,current:0,type:"prop",status:"live"},
    {desc:"Peterka 2+ SOG",player:"JJ Peterka",prop:"SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Hughes 2+ SOG",player:"Quinn Hughes",prop:"SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Eichel 4+ SOG",player:"Jack Eichel",prop:"SOG",target:4,current:0,type:"stat",status:"live"},
    {desc:"Matthews 3+ SOG",player:"Auston Matthews",prop:"SOG",target:3,current:0,type:"stat",status:"live"},
    {desc:"B.Tkachuk 3+ SOG",player:"Brady Tkachuk",prop:"SOG",target:3,current:0,type:"stat",status:"live"}]},
{id:"a04",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"B.Tkachuk 3+ Goals+M.Tkachuk 3+ Pts",odds:"+11822",wager:0.10,payout:11.92,gameId:"401845680",
  legs:[{desc:"B.Tkachuk 3+ Goals",player:"Brady Tkachuk",prop:"Goals",target:3,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk 3+ Points",player:"Matthew Tkachuk",prop:"Points",target:3,current:0,type:"stat",status:"live"}]},
{id:"a05",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"M.Tkachuk 1st Goal+B.Tkachuk ATGS",odds:"+2184",wager:0.10,payout:2.28,gameId:"401845680",
  legs:[{desc:"M.Tkachuk 1st Goal",player:"Matthew Tkachuk",prop:"1st Goal",target:1,current:0,type:"prop",status:"live"},
    {desc:"B.Tkachuk ATGS",player:"Brady Tkachuk",prop:"ATGS",target:1,current:0,type:"stat",status:"live"}]},
{id:"a06",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"B.Tkachuk 1st Goal+M.Tkachuk 2+ Goals",odds:"+10697",wager:0.10,payout:10.80,gameId:"401845680",
  legs:[{desc:"B.Tkachuk 1st Goal",player:"Brady Tkachuk",prop:"1st Goal",target:1,current:0,type:"prop",status:"live"},
    {desc:"M.Tkachuk 2+ Goals",player:"Matthew Tkachuk",prop:"Goals",target:2,current:0,type:"stat",status:"live"}]},
{id:"a07",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"Points & SOG Mega Parlay (15 legs)",odds:"+13526",wager:0.10,payout:13.63,gameId:"401845680",
  legs:[{desc:"B.Tkachuk 1+ Pts",player:"Brady Tkachuk",prop:"Points",target:1,current:0,type:"stat",status:"live"},
    {desc:"Boldy 1P 1+ SOG",player:"Matt Boldy",prop:"1P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Boldy 3P 1+ SOG",player:"Matt Boldy",prop:"3P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk 2P 1+ SOG",player:"Matthew Tkachuk",prop:"2P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Werenski 2P 1+ SOG",player:"Zach Werenski",prop:"2P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Eichel 2P 2+ SOG",player:"Jack Eichel",prop:"2P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Eichel 2+ Pts",player:"Jack Eichel",prop:"Points",target:2,current:0,type:"stat",status:"live"},
    {desc:"Matthews 1+ Pts",player:"Auston Matthews",prop:"Points",target:1,current:0,type:"stat",status:"live"},
    {desc:"Draisaitl 1+ Pts",player:"Leon Draisaitl",prop:"Points",target:1,current:0,type:"stat",status:"live"},
    {desc:"Guentzel 3P 1+ SOG",player:"Jake Guentzel",prop:"3P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Boldy 2P 1+ SOG",player:"Matt Boldy",prop:"2P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk 3P 1+ SOG",player:"Matthew Tkachuk",prop:"3P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"B.Tkachuk 3P 1+ SOG",player:"Brady Tkachuk",prop:"3P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk 1P 1+ SOG",player:"Matthew Tkachuk",prop:"1P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk 2+ Pts",player:"Matthew Tkachuk",prop:"Points",target:2,current:0,type:"stat",status:"live"}]},
{id:"a08",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"Matthews+SOG+Eichel+Guentzel (10 legs)",odds:"+24973",wager:0.10,payout:25.07,gameId:"401845680",
  legs:[{desc:"Matthews 1P 2+ SOG",player:"Auston Matthews",prop:"1P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk 2P 1+ SOG",player:"Matthew Tkachuk",prop:"2P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Peterka 2P 1+ SOG",player:"JJ Peterka",prop:"2P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Peterka 3P 1+ SOG",player:"JJ Peterka",prop:"3P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Draisaitl 3P 1+ SOG",player:"Leon Draisaitl",prop:"3P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Werenski 2P 2+ SOG",player:"Zach Werenski",prop:"2P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"B.Tkachuk 2P 1+ SOG",player:"Brady Tkachuk",prop:"2P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Eichel ATGS",player:"Jack Eichel",prop:"ATGS",target:1,current:0,type:"stat",status:"live"},
    {desc:"Draisaitl 1+ Pts",player:"Leon Draisaitl",prop:"Points",target:1,current:0,type:"stat",status:"live"},
    {desc:"Guentzel 2+ Pts",player:"Jake Guentzel",prop:"Points",target:2,current:0,type:"stat",status:"live"}]},
{id:"a09",type:"hockey",status:"active",event:"Germany @ USA",market:"correct_score",pick:"USA 7-1",odds:"+3000",wager:0.10,payout:3.10,gameId:"401845680"},
{id:"a10",type:"hockey",status:"active",event:"Germany @ USA",market:"correct_score",pick:"USA 6-2",odds:"+1700",wager:0.10,payout:1.80,gameId:"401845680"},
{id:"a11",type:"hockey",status:"active",event:"Germany @ USA",market:"correct_score",pick:"USA 6-0",odds:"+3500",wager:0.10,payout:3.60,gameId:"401845680"},
{id:"a12",type:"hockey",status:"active",event:"Germany @ USA",market:"correct_score",pick:"USA 6-5",odds:"+40000",wager:0.10,payout:40.10,gameId:"401845680"},
{id:"a13",type:"hockey",status:"active",event:"Germany @ USA",market:"correct_score",pick:"USA 7-0",odds:"+4000",wager:0.10,payout:4.10,gameId:"401845680"},
{id:"a14",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"Reichel ATGS+3P SOG plays",odds:"+13168",wager:0.10,payout:13.27,gameId:"401845680",
  legs:[{desc:"Reichel ATGS",player:"Lukas Reichel",prop:"ATGS",target:1,current:0,type:"stat",status:"live"},
    {desc:"Reichel 3P 2+ SOG",player:"Lukas Reichel",prop:"3P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Peterka 3P 2+ SOG",player:"JJ Peterka",prop:"3P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Seider 3P 3+ SOG",player:"Moritz Seider",prop:"3P SOG",target:3,current:0,type:"stat",status:"live"}]},
{id:"a15",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"Seider+Boldy+M.Tkachuk+more 3P SOG",odds:"+8456",wager:0.10,payout:8.56,gameId:"401845680",
  legs:[{desc:"Seider 3P 2+ SOG",player:"Moritz Seider",prop:"3P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Boldy 3P 2+ SOG",player:"Matt Boldy",prop:"3P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"M.Tkachuk ATGS",player:"Matthew Tkachuk",prop:"ATGS",target:1,current:0,type:"stat",status:"live"},
    {desc:"B.Tkachuk 3P 2+ SOG",player:"Brady Tkachuk",prop:"3P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Eichel 3P 1+ SOG",player:"Jack Eichel",prop:"3P SOG",target:1,current:0,type:"stat",status:"live"},
    {desc:"Draisaitl 3P 1+ SOG",player:"Leon Draisaitl",prop:"3P SOG",target:1,current:0,type:"stat",status:"live"}]},
{id:"a16",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"Seider ATGS+Draisaitl/Seider/Boldy 3P SOG",odds:"+12559",wager:0.10,payout:12.66,gameId:"401845680",
  legs:[{desc:"Seider ATGS",player:"Moritz Seider",prop:"ATGS",target:1,current:0,type:"stat",status:"live"},
    {desc:"Draisaitl 3P 2+ SOG",player:"Leon Draisaitl",prop:"3P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Seider 3P 3+ SOG",player:"Moritz Seider",prop:"3P SOG",target:3,current:0,type:"stat",status:"live"},
    {desc:"Boldy 3P 2+ SOG",player:"Matt Boldy",prop:"3P SOG",target:2,current:0,type:"stat",status:"live"}]},
{id:"a17",type:"hockey",status:"active",event:"Germany @ USA",market:"sgp",pick:"Seider 2P Goal+Seider 3P 3+ SOG",odds:"+8457",wager:0.10,payout:8.56,gameId:"401845680",
  legs:[{desc:"Seider 2P Goal",player:"Moritz Seider",prop:"2P Goal",target:1,current:0,type:"stat",status:"live"},
    {desc:"Seider 3P 3+ SOG",player:"Moritz Seider",prop:"3P SOG",target:3,current:0,type:"stat",status:"live"}]},
{id:"a18",type:"hockey",status:"active",event:"Germany @ USA",market:"correct_score",pick:"USA 4-0",odds:"+1000",wager:0.10,payout:1.10,gameId:"401845680"},
{id:"a19",type:"hockey",status:"active",event:"Germany @ USA",market:"correct_score",pick:"USA 3-1",odds:"+1900",wager:0.10,payout:2.00,gameId:"401845680"},
{id:"a20",type:"hockey",status:"active",event:"Germany @ USA",market:"correct_score",pick:"USA 5-1",odds:"+1000",wager:0.10,payout:1.10,gameId:"401845680"},
{id:"a21",type:"hockey",status:"active",event:"GER@USA + LAT@DEN",market:"sgp",pick:"Draisaitl SOG+3P Goal+Tralmaks 2+",odds:"+44350",wager:0.10,payout:44.45,
  legs:[{desc:"Draisaitl 1P 2+ SOG",player:"Leon Draisaitl",prop:"1P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Draisaitl 2P 2+ SOG",player:"Leon Draisaitl",prop:"2P SOG",target:2,current:0,type:"stat",status:"live"},
    {desc:"Draisaitl 3P Goal",player:"Leon Draisaitl",prop:"3P Goal",target:1,current:0,type:"stat",status:"live"},
    {desc:"Tralmaks 2+ Goals (LAT@DEN)",player:"Rihards Tralmaks",prop:"Goals",target:2,current:0,type:"stat",status:"miss"}],
  deadReason:"LAT@DEN game final: Tralmaks did not score 2+"},

// === PENDING MEDAL FUTURES ===
{id:"p01",type:"medal",status:"pending",event:"Women's Slalom",market:"futures",pick:"Martina Peterlini (ITA) Medal",odds:"+6500",wager:0.10,payout:6.60,eventDate:"Tue 11:00am ET"},
{id:"p02",type:"medal",status:"pending",event:"Women's Slalom",market:"futures",pick:"Eliane Christen (SUI) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 11:00am ET"},
{id:"p03",type:"medal",status:"pending",event:"Women's Slalom",market:"futures",pick:"Lara Della Mea (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 11:00am ET"},
{id:"p04",type:"medal",status:"pending",event:"Women's Slalom",market:"futures",pick:"Caitlin McFarlane (FRA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 11:00am ET"},
{id:"p05",type:"medal",status:"pending",event:"Women's Slalom",market:"futures",pick:"Paula Moltzan (USA) Gold",odds:"+1800",wager:0.10,payout:1.90,eventDate:"Tue 11:00am ET"},
{id:"p06",type:"medal",status:"pending",event:"Women's Slopestyle",market:"futures",pick:"Lily Dhawornvej (USA) Gold",odds:"+6500",wager:0.16,payout:10.56,eventDate:"Tue 7:00am ET"},
{id:"p07",type:"medal",status:"pending",event:"Women's Slopestyle",market:"futures",pick:"Jessica Perlmutter (USA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 7:00am ET"},
{id:"p08",type:"medal",status:"pending",event:"2 Man Bobsleigh",market:"futures",pick:"Cedric Follador (SUI) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Mon 4:00am ET"},
{id:"p09",type:"medal",status:"pending",event:"2 Man Bobsleigh",market:"futures",pick:"Patrick Baumgartner (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Mon 4:00am ET"},
{id:"p10",type:"medal",status:"pending",event:"Women's Monobob",market:"futures",pick:"Simone De Silvestro (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Mon 4:00am ET"},
{id:"p11",type:"medal",status:"pending",event:"Women's Monobob",market:"futures",pick:"Giada Andreutti (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Mon 4:00am ET"},
{id:"p12",type:"medal",status:"pending",event:"Women's Figure Skating",market:"futures",pick:"Isabeau Levito (USA) Gold",odds:"+3300",wager:0.10,payout:3.40,eventDate:"Tue 12:45pm ET"},
{id:"p13",type:"medal",status:"pending",event:"Women's Figure Skating",market:"futures",pick:"Anna Pezzetta (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 12:45pm ET"},
{id:"p14",type:"medal",status:"pending",event:"Women's Figure Skating",market:"futures",pick:"Lara Naki Gutmann (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 12:45pm ET"},
{id:"p15",type:"medal",status:"pending",event:"Men's 1500m Speed Skating",market:"futures",pick:"Daniele Di Stefano (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Thu 10:30am ET"},
{id:"p16",type:"medal",status:"pending",event:"Men's Nordic Combined",market:"futures",pick:"Samuel Costa (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Mon 3:00am ET"},
{id:"p17",type:"medal",status:"pending",event:"Men's Slalom",market:"futures",pick:"Tobias Kastlunger (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Mon 11:00am ET"},
{id:"p18",type:"medal",status:"pending",event:"Men's Slalom",market:"futures",pick:"Benjamin Ritchie (USA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Mon 11:00am ET"},
{id:"p19",type:"medal",status:"pending",event:"Women's Slalom",market:"futures",pick:"Martina Peterlini (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 4:00am ET"},
{id:"p20",type:"medal",status:"pending",event:"Women's Slopestyle",market:"futures",pick:"Hahna Norman (USA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 8:15am ET"},
{id:"p21",type:"medal",status:"pending",event:"Women's Aerials",market:"futures",pick:"Tasia Tanner (USA) Gold",odds:"+6500",wager:0.10,payout:6.60,eventDate:"Tue 4:45am ET"},
{id:"p22",type:"medal",status:"pending",event:"Women's Ski Cross",market:"futures",pick:"Morgan Shute (USA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Fri 6:00am ET"},
{id:"p23",type:"medal",status:"pending",event:"Men's Ski Cross",market:"futures",pick:"Tyler Wallasch (USA) Gold",odds:"+8000",wager:0.10,payout:8.10,eventDate:"Sat 4:00am ET"},
{id:"p24",type:"medal",status:"pending",event:"Men's Aerials",market:"futures",pick:"Derek Krueger (USA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 7:30am ET"},
{id:"p25",type:"medal",status:"pending",event:"Men's Big Air",market:"futures",pick:"Miro Tabanelli (ITA) Gold",odds:"+5000",wager:0.10,payout:5.10,eventDate:"Sat 1:30pm ET"},
{id:"p26",type:"medal",status:"pending",event:"Men's Big Air",market:"futures",pick:"Konnor Ralph (USA) Gold",odds:"+5000",wager:0.10,payout:5.10,eventDate:"Sat 1:30pm ET"},
{id:"p27",type:"medal",status:"pending",event:"Women's Biathlon Mass Start",market:"futures",pick:"Lisa Theresa Hauser (AUT) Gold",odds:"+6500",wager:0.10,payout:6.60,eventDate:"Sat 8:45am ET"},
{id:"p28",type:"medal",status:"pending",event:"Women's Biathlon 4x6km Relay",market:"futures",pick:"Slovakia Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Wed 8:45am ET"},
{id:"p29",type:"medal",status:"pending",event:"Women's Biathlon 4x6km Relay",market:"futures",pick:"Austria Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Wed 8:45am ET"},
{id:"p30",type:"medal",status:"pending",event:"Women's Biathlon 4x6km Relay",market:"futures",pick:"United States Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Wed 8:45am ET"},
{id:"p31",type:"medal",status:"pending",event:"Women's Slalom",market:"futures",pick:"Martina Peterlini (ITA) Medal",odds:"+6500",wager:0.10,payout:6.60,eventDate:"Tue 4:00am ET"},
{id:"p32",type:"medal",status:"pending",event:"Women's Slalom",market:"futures",pick:"Martina Peterlini (ITA) Gold",odds:"+10000",wager:0.10,payout:10.10,eventDate:"Tue 4:00am ET"},
];

// ===== ESPN API =====
const ESPN_M="https://site.api.espn.com/apis/site/v2/sports/hockey/olympics-mens-ice-hockey";
const ESPN_W="https://site.api.espn.com/apis/site/v2/sports/hockey/olympics-womens-ice-hockey";
let liveGames={};
let playerStats={};
let scoringPlaysData={};

async function fetchHockeyScores(){
  try{
    for(const base of[ESPN_M,ESPN_W]){
      const r=await fetch(base+"/scoreboard");
      const d=await r.json();
      if(d.events)for(const ev of d.events){
        const gid=ev.id;const comp=ev.competitions?.[0];if(!comp)continue;
        const teams={};
        comp.competitors?.forEach(c=>{
          teams[c.team.abbreviation]={abbr:c.team.abbreviation,name:c.team.displayName,score:parseInt(c.score)||0};
        });
        const statusDetail=comp.status?.type?.detail||"";
        const clock=comp.status?.displayClock||"";
        const period=comp.status?.period||0;
        const statusState=comp.status?.type?.state||"pre";
        let status="Scheduled";
        if(statusState==="in")status="In Progress";
        else if(statusState==="post")status=statusDetail.includes("OT")?"Final/OT":statusDetail.includes("SO")?"Final/SO":"Final";
        liveGames[gid]={teams,status,clock,period,detail:statusDetail};
        // Fetch box score
        try{
          const br=await fetch(base+"/summary?event="+gid);
          const bd=await br.json();
          parseBoxScore(gid,bd);parseScoringPlays(gid,bd);
        }catch(e){}
      }
    }
  }catch(e){console.error("ESPN fetch error:",e)}
}

function parseBoxScore(gid,data){
  if(!data.boxscore?.players)return;
  if(!playerStats[gid])playerStats[gid]={};
  data.boxscore.players.forEach(team=>{
    team.statistics?.forEach(statGroup=>{
      const labels=statGroup.labels||[];
      statGroup.athletes?.forEach(ath=>{
        const name=ath.athlete?.displayName;if(!name)return;
        const stats={};
        ath.stats?.forEach((val,i)=>{if(labels[i])stats[labels[i]]=val});
        playerStats[gid][name]={
          G:parseInt(stats.G)||0,A:parseInt(stats.A)||0,
          S:parseInt(stats.S||stats.SOG)||0,
          PTS:parseInt(stats.PTS||stats.P)||0,
          name:name
        };
      });
    });
  });
  // Team SOG
  if(data.boxscore?.teams){
    data.boxscore.teams.forEach(t=>{
      const abbr=t.team?.abbreviation;
      if(abbr&&liveGames[gid]?.teams[abbr]){
        t.statistics?.forEach(sg=>{
          sg.labels?.forEach((l,i)=>{
            if(l==="SOG"||l==="S")liveGames[gid].teams[abbr].sog=parseInt(sg.totals?.[i])||0;
          });
        });
      }
    });
  }
}

function parseScoringPlays(gid,data){
  if(!data.scoringPlays)return;
  scoringPlaysData[gid]=data.scoringPlays.map(sp=>{
    const period=sp.period?.number||0;const clock=sp.clock?.displayValue||"";
    const text=sp.text||sp.description||"Goal";
    const team=sp.team?.abbreviation||"";
    return{period,clock,text,team};
  });
}

// ===== LEG STATUS UPDATES =====
function updateLegStatuses(){
  BETS.forEach(b=>{
    if(!b.gameId)return;
    const game=liveGames[b.gameId];if(!game)return;
    const ps=playerStats[b.gameId]||{};

    // Correct score matching
    if(b.market==="correct_score"&&game){
      const abbrs=Object.keys(game.teams);
      if(abbrs.length===2&&(game.status==="Final"||game.status==="Final/OT"||game.status==="Final/SO")){
        const s1=game.teams[abbrs[0]]?.score||0,s2=game.teams[abbrs[1]]?.score||0;
        const pickNorm=b.pick.toLowerCase().replace(/‚Äì/g,"-").replace(/‚Äî/g,"-").replace(/\s+/g," ");
        const pickNums=pickNorm.match(/(\d+)\s*-\s*(\d+)/);
        let isWin=false;
        if(pickNums){
          const pH=parseInt(pickNums[1]),pA=parseInt(pickNums[2]);
          // Check for tie picks (e.g. "Tie 5-5")
          const isTiePick=pickNorm.includes("tie")||pH===pA;
          if(isTiePick){
            // For tie picks, both scores must match
            isWin=(s1===s2&&s1===pH&&s2===pA);
          }else if((pH===s1&&pA===s2)||(pH===s2&&pA===s1)){
            const pickTeam=pickNorm.split(/\d/)[0].trim().toUpperCase();
            if(!pickTeam){isWin=(pH===Math.max(s1,s2)&&pA===Math.min(s1,s2))}
            else{
              const matchAbbr=abbrs.find(a=>pickTeam.includes(a));
              if(matchAbbr){isWin=(pH===game.teams[matchAbbr].score&&pA===game.teams[abbrs.find(a=>a!==matchAbbr)]?.score)}
              else{isWin=(pH===s1&&pA===s2)}
            }
          }
        }
        if(isWin){b.status="won";b.payout=b.wager*(1+oddsNum(b.odds)/100)}
        else{b.status="lost";b.payout=0}
        b.result=`${abbrs[0]} ${s1}‚Äì${s2} ${abbrs[1]}`;
      }
    }

    // SGP leg updates
    if(b.legs){
      let hasDead=false;
      b.legs.forEach(leg=>{
        if(leg.type==="stat"&&leg.player&&leg.target){
          const pData=findPlayer(ps,leg.player);
          if(pData){
            // Check if this is a period-specific prop (1P/2P/3P)
            const isPeriodProp=/\b[123]P\b/.test(leg.prop||"")||/\b[123]P\b/.test(leg.desc||"");
            const gameFinal=game.status==="Final"||game.status==="Final/OT"||game.status==="Final/SO";
            if(isPeriodProp){
              // Period-specific: ESPN box score only has game totals
              // Use total stats as a ceiling check: if total < target, period can't have met it
              const totalVal=getStatValue(pData,leg.prop);
              if(gameFinal){
                // At game end, total >= target means POSSIBLE hit, but we can't confirm period
                // Mark as "hit" if total >= target (optimistic) ‚Äî manual verify needed
                if(totalVal>=leg.target){leg.current=leg.target;leg.status="hit"}
                else{leg.current=totalVal;leg.status="miss";hasDead=true}
              }else{
                // During game: show total as reference, mark as period-tracking
                leg.current=totalVal;leg.periodNote=true;
                if(totalVal>=leg.target)leg.status="live"; // total met, period unknown
                else{
                  const pct=totalVal/leg.target;
                  if(pct>=0.5)leg.status="sweat";
                  else leg.status="cold";
                }
              }
            }else{
              // Non-period prop: use total stats directly
              leg.current=getStatValue(pData,leg.prop);
              if(leg.current>=leg.target)leg.status="hit";
              else if(gameFinal){leg.status="miss";hasDead=true}
              else{
                const pct=leg.current/leg.target;
                if(pct>=0.5)leg.status="live";
                else if(pct>=0.25)leg.status="sweat";
                else leg.status="cold";
              }
            }
          }
        }
        if(leg.type==="ml"){
          const abbrs=Object.keys(game.teams);
          if(abbrs.length===2){
            const s1=game.teams[abbrs[0]]?.score||0,s2=game.teams[abbrs[1]]?.score||0;
            const desc=leg.desc.toLowerCase();
            const isTeam1=desc.includes(abbrs[0].toLowerCase())||desc.includes(game.teams[abbrs[0]]?.name?.split(" ").pop()?.toLowerCase()||"xxx");
            const teamScore=isTeam1?s1:s2;const oppScore=isTeam1?s2:s1;
            if(teamScore>oppScore)leg.status="winning";
            else if(teamScore<oppScore){leg.status="losing";const gameFinal=game.status==="Final"||game.status==="Final/OT"||game.status==="Final/SO";if(gameFinal)hasDead=true}
            else leg.status="tied";
          }
        }
      });
      if(hasDead&&b.status==="active"){
        b.status="dead";
        const missLeg=b.legs.find(l=>l.status==="miss"||l.status==="losing");
        b.deadReason=missLeg?`${missLeg.desc} ‚Äî missed`:"Leg missed";
      }
      // Check if all legs hit
      if(b.legs.every(l=>l.status==="hit"||l.status==="winning")&&b.legs.length>0){
        b.status="won";b.payout=b.wager*(1+oddsNum(b.odds)/100);
      }
    }
  });
}

function findPlayer(stats,name){
  if(stats[name])return stats[name];
  const last=name.split(" ").pop().toLowerCase();
  const match=Object.entries(stats).find(([k])=>k.toLowerCase().includes(last));
  return match?match[1]:null;
}

function getStatValue(pStats,prop){
  const p=prop.toLowerCase();
  if(p.includes("goal")||p==="atgs")return pStats.G||0;
  if(p.includes("assist"))return pStats.A||0;
  if(p.includes("sog")||p.includes("shot"))return pStats.S||0;
  if(p.includes("point")||p.includes("pts"))return pStats.PTS||0;
  return 0;
}

// ===== STATE =====
let activeFilter="active";
let expandedBets=new Set();
let collapsedSections=new Set();
let searchText="";
let autoRefreshInterval=null;

const JERSEYS={
  "Auston Matthews":"#34","Brady Tkachuk":"#7","Matthew Tkachuk":"#19",
  "Jack Eichel":"#9","Leon Draisaitl":"#29","Quinn Hughes":"#43",
  "Jake Guentzel":"#59","Matt Boldy":"#12","Zach Werenski":"#8",
  "JJ Peterka":"#77","Moritz Seider":"#53","Lukas Reichel":"#44",
  "Daniel Tiffels":"#51","Lars Eller":"#20","Nikolaj Ehlers":"#27",
  "Nick Olesen":"#60","Rihards Tralmaks":"#21","Zemgus Girgensons":"#28",
  "Marie-Philip Poulin":"#29"
};

// ===== HELPERS =====
function oddsNum(s){return parseInt((s||"0").replace("+","").replace(",",""))||0}
function getLegCount(b){return b.legs?b.legs.length:0}
function getLegsHit(b){return b.legs?b.legs.filter(l=>l.status==="hit"||l.status==="winning").length:0}
function getLegsPct(b){const t=getLegCount(b);return t?getLegsHit(b)/t:0}
function getAvgProgress(b){
  if(!b.legs)return 0;
  const tracked=b.legs.filter(l=>l.target);
  if(!tracked.length)return 0;
  return tracked.reduce((s,l)=>s+Math.min(1,(l.current||0)/l.target),0)/tracked.length;
}

// Parse "Mon 4:00am ET" or "Tue 11:00am ET" to sortable number
function parseEventDate(s){
  const dayOrder={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6};
  const m=s.match(/(\w+)\s+(\d+):(\d+)\s*(am|pm)/i);
  if(!m)return 999;
  const day=dayOrder[m[1].toLowerCase().substring(0,3)]||0;
  let hr=parseInt(m[2]);const min=parseInt(m[3]);
  if(m[4].toLowerCase()==="pm"&&hr<12)hr+=12;
  if(m[4].toLowerCase()==="am"&&hr===12)hr=0;
  return day*1440+hr*60+min;
}

function getBadge(b){
  const map={active:"badge-active",live:"badge-live",won:"badge-won",lost:"badge-lost",pending:"badge-pending",dead:"badge-dead"};
  const labels={active:"LIVE",live:"LIVE",won:"WON",lost:"LOST",pending:"PENDING",dead:"‚ò† DEAD"};
  return`<span class="badge ${map[b.status]||"badge-pending"}">${labels[b.status]||b.status.toUpperCase()}</span>`;
}

function getMarketLabel(m){
  return{sgp:"SGP",correct_score:"Score",futures:"Futures"}[m]||m;
}

function progressRingSVG(b){
  if(!b.legs||!b.legs.length)return"";
  const hit=getLegsHit(b),tot=b.legs.length;
  const r=18,circ=2*Math.PI*r;
  const offset=circ*(1-hit/tot);
  const color=hit===tot?"var(--win)":hit>0?"var(--teal)":"var(--text3)";
  // Add horizontal progress bar below ring
  const barPct=Math.round(getAvgProgress(b)*100);
  const barColor=barPct>=80?"var(--win)":barPct>=40?"var(--blue)":barPct>0?"var(--sweat)":"#334155";
  return`<div style="display:flex;flex-direction:column;align-items:center;gap:2px;flex-shrink:0">
    <div class="ring-wrap">
      <svg width="44" height="44"><circle cx="22" cy="22" r="${r}" fill="none" stroke="var(--surface2)" stroke-width="3.5"/>
      <circle cx="22" cy="22" r="${r}" fill="none" stroke="${color}" stroke-width="3.5"
        stroke-dasharray="${circ}" stroke-dashoffset="${offset}" stroke-linecap="round"/></svg>
      <span class="ring-count" style="color:${color}">${hit}/${tot}</span>
    </div>
    <div style="width:44px;height:4px;background:#1e293b;border-radius:2px;overflow:hidden">
      <div style="width:${barPct}%;height:100%;background:${barColor};border-radius:2px;transition:width .3s"></div>
    </div>
  </div>`;
}

function getLegStatusInfo(leg,bet){
  const cur=leg.current||0;const tgt=leg.target||0;
  const pct=tgt?(cur/tgt*100):0;
  // Override status based on actual progress ‚Äî don't trust hardcoded "live"
  let st=leg.status;
  if(tgt>0&&(st==="live"||st==="cold"||st==="sweat")){
    if(cur>=tgt)st="hit";
    else if(pct>=50)st="live";
    else if(pct>=25)st="sweat";
    else st="cold";
  }
  // Props with target but 0 current at game start = COLD, not ON PACE
  if(tgt>0&&cur===0&&st==="live")st="cold";
  const map={
    hit:{label:"‚úÖ HIT",rowClass:"leg-hit",badgeClass:"lsb-hit",barClass:"bar-hit",pct:100},
    miss:{label:"‚ùå MISS",rowClass:"leg-miss",badgeClass:"lsb-miss",barClass:"bar-miss",pct:100},
    live:{label:"üîµ ON PACE",rowClass:"leg-live",badgeClass:"lsb-live",barClass:"bar-live",pct},
    sweat:{label:"üü° SWEAT",rowClass:"leg-sweat",badgeClass:"lsb-sweat",barClass:"bar-sweat",pct},
    cold:{label:"‚¨ú WAITING",rowClass:"leg-cold",badgeClass:"lsb-cold",barClass:"bar-cold",pct},
    pending:{label:"‚è≥ TBD",rowClass:"leg-pending",badgeClass:"lsb-pending",barClass:"bar-pending",pct:0},
    notstarted:{label:"‚è≥ TBD",rowClass:"leg-pending",badgeClass:"lsb-pending",barClass:"bar-pending",pct:0},
    winning:{label:"‚úÖ WINNING",rowClass:"leg-hit",badgeClass:"lsb-winning",barClass:"bar-hit",pct:100},
    losing:{label:"‚ùå LOSING",rowClass:"leg-miss",badgeClass:"lsb-losing",barClass:"bar-miss",pct:100},
    tied:{label:"üü° TIED",rowClass:"leg-sweat",badgeClass:"lsb-tied",barClass:"bar-sweat",pct:50},
  };
  return map[st]||map.pending;
}

function renderLegsDetail(b){
  if(!b.legs||!b.legs.length)return"";
  let html='<div class="legs-list">';
  b.legs.forEach(leg=>{
    const ls=getLegStatusInfo(leg,b);
    const jersey=leg.player&&JERSEYS[leg.player]?`<span style="color:var(--teal);font-weight:700">${JERSEYS[leg.player]}</span> `:"";
    const progressText=leg.current!==undefined&&leg.target?` <span style="font-family:Oswald;font-weight:700;font-size:1.05em">${leg.current}/${leg.target}</span>${leg.periodNote?'<span style="font-size:.65em;color:var(--text3);margin-left:3px" title="Period-specific: using game totals as reference">*total</span>':''}`:"";
    const barPct=leg.target?ls.pct:(leg.status==="hit"||leg.status==="winning"?100:leg.status==="miss"||leg.status==="losing"?100:0);
    const barClass=leg.target?ls.barClass:(leg.status==="hit"||leg.status==="winning"?"bar-hit":leg.status==="miss"||leg.status==="losing"?"bar-miss":"bar-pending");
    html+=`<div class="leg-row ${ls.rowClass}">
      <div class="leg-name">${jersey}${leg.desc}${progressText}</div>
      <span class="leg-status-badge ${ls.badgeClass}">${ls.label}</span>
      <div style="display:flex;align-items:center;justify-content:flex-end">
        <div class="leg-bar"><div class="leg-bar-fill ${barClass}" style="width:${barPct}%"></div></div>
      </div>
    </div>`;
  });
  html+='</div>';
  return html;
}

function getGameWidget(b){
  if(b.status==="lost"||b.status==="won"||b.status==="dead"){
    if(b.result)return`<div class="game-widget"><div style="text-align:center;font-size:.85em;padding:4px"><strong>Final:</strong> ${b.result}</div></div>`;
    return"";
  }
  if(!b.gameId||!liveGames[b.gameId])return"";
  const g=liveGames[b.gameId];
  const abbrs=Object.keys(g.teams);if(abbrs.length<2)return"";
  const t1=g.teams[abbrs[0]],t2=g.teams[abbrs[1]];
  const statusLabel=g.status==="In Progress"?"LIVE":g.status;
  const statusColor=g.status==="In Progress"?"var(--teal)":g.status.includes("Final")?"var(--lose)":"var(--text3)";
  let html=`<div class="game-widget"><div class="game-score">
    <div class="game-team"><div class="game-team-abbr">${abbrs[0]}</div><div class="game-team-score">${t1.score}</div></div>
    <div class="game-status"><div style="color:${statusColor};font-size:.8em">${statusLabel}</div>
      ${g.clock?`<div style="font-size:.65em;color:var(--text3)">${g.clock} P${g.period}</div>`:""}</div>
    <div class="game-team"><div class="game-team-abbr">${abbrs[1]}</div><div class="game-team-score">${t2.score}</div></div>
  </div>`;
  // SOG stats
  if(t1.sog!==undefined)html+=`<div style="display:flex;justify-content:space-around;font-size:.7em;color:var(--text2);margin-top:4px;padding-top:4px;border-top:1px solid var(--border)">
    <span>${abbrs[0]} SOG: <strong>${t1.sog||0}</strong></span><span>${abbrs[1]} SOG: <strong>${t2.sog||0}</strong></span></div>`;
  // Scoring plays
  const plays=scoringPlaysData[b.gameId];
  if(plays&&plays.length)html+=`<details style="margin-top:6px"><summary style="font-size:.7em;color:var(--text3);cursor:pointer">Scoring Plays (${plays.length})</summary>
    <div style="margin-top:4px">${plays.map(p=>`<div style="font-size:.7em;color:var(--text2);padding:2px 0"><span style="color:var(--gold);font-weight:700">P${p.period} ${p.clock}</span> ${p.team} ‚Äî ${p.text}</div>`).join("")}</div></details>`;
  html+='</div>';
  return html;
}

// ===== FILTERING & SORTING =====
function filterBets(){
  let list=[...BETS];
  if(searchText){
    const q=searchText.toLowerCase();
    list=list.filter(b=>(b.pick+b.event+b.market+(b.legs||[]).map(l=>l.desc||l).join(" ")).toLowerCase().includes(q));
  }
  if(activeFilter!=="all"){
    list=list.filter(b=>{
      if(activeFilter==="active")return b.status==="active"||b.status==="live"||b.status==="pending";
      if(activeFilter==="pending")return b.status==="pending";
      if(activeFilter==="settled")return b.status==="lost"||b.status==="won"||b.status==="dead";
      if(activeFilter==="won")return b.status==="won";
      if(activeFilter==="lost")return b.status==="lost"||b.status==="dead";
      return true;
    });
  }
  return list;
}

function sortBets(list){
  const sort=document.getElementById("sortSelect").value;
  const order={active:0,live:0,pending:1,dead:2,won:3,lost:4};
  if(sort==="status")list.sort((a,b)=>{
    const oa=(order[a.status]??2),ob=(order[b.status]??2);
    if(oa!==ob)return oa-ob;
    // Within pending: sort by eventDate
    if(a.status==="pending"&&b.status==="pending"&&a.eventDate&&b.eventDate){
      return parseEventDate(a.eventDate)-parseEventDate(b.eventDate);
    }
    // Within same status, sort by payout desc
    return b.payout-a.payout;
  });
  else if(sort==="payout-desc")list.sort((a,b)=>b.payout-a.payout);
  else if(sort==="payout-asc")list.sort((a,b)=>a.payout-b.payout);
  else if(sort==="odds-desc")list.sort((a,b)=>oddsNum(b.odds)-oddsNum(a.odds));
  else if(sort==="odds-asc")list.sort((a,b)=>oddsNum(a.odds)-oddsNum(b.odds));
  else if(sort==="wager-desc")list.sort((a,b)=>b.wager-a.wager);
  else if(sort==="legs-desc")list.sort((a,b)=>getLegsHit(b)-getLegsHit(a));
  else if(sort==="legs-pct")list.sort((a,b)=>getLegsPct(b)-getLegsPct(a));
  else if(sort==="legs-progress")list.sort((a,b)=>getAvgProgress(b)-getAvgProgress(a));
  return list;
}

// ===== RENDER SUMMARY =====
function renderSummary(){
  const total=BETS.length;
  const live=BETS.filter(b=>b.status==="active"||b.status==="live").length;
  const pending=BETS.filter(b=>b.status==="pending").length;
  const won=BETS.filter(b=>b.status==="won").length;
  const lost=BETS.filter(b=>b.status==="lost"||b.status==="dead").length;
  const wagered=BETS.reduce((s,b)=>s+b.wager,0);
  const potential=BETS.filter(b=>b.status!=="lost"&&b.status!=="dead").reduce((s,b)=>s+b.payout,0);
  const returned=BETS.filter(b=>b.status==="won").reduce((s,b)=>s+b.payout,0);
  const dream=BETS.filter(b=>b.status!=="lost"&&b.status!=="dead").reduce((s,b)=>s+b.payout,0);
  const items=[
    ["Total",total,"var(--text)"],["‚ö° Live",live,"var(--teal)"],["üìÖ Pending",pending,"var(--text3)"],
    ["‚úÖ Won",won,"var(--win)"],["‚ùå Lost",lost,"var(--lose)"],
    ["Wagered","$"+wagered.toFixed(2),"#fca5a5"],["Potential","$"+potential.toFixed(2),"var(--gold)"],
    ["Returned","$"+returned.toFixed(2),"var(--win)"],["üåü Dream","$"+dream.toFixed(2),"#a855f7"]
  ];
  document.getElementById("summary").innerHTML=items.map(([l,v,c])=>
    `<div class="stat-card"><div class="stat-label">${l}</div><div class="stat-val" style="color:${c}">${v}</div></div>`
  ).join("");
}

// ===== RENDER SECTIONS =====
function renderAll(){
  const filtered=sortBets(filterBets());
  // Group by section
  const sections=[
    {key:"sgp",label:"üèí Same Game Parlays",headerCls:"hockey-sgp",bodyCls:"hockey-sgp-body",bets:filtered.filter(b=>b.market==="sgp"&&b.type==="hockey")},
    {key:"correct_score",label:"üéØ Correct Score Picks",headerCls:"correct-score",bodyCls:"correct-score-body",bets:filtered.filter(b=>b.market==="correct_score")},
    {key:"medal_sgp",label:"üèÖ Medal & Multi-Sport Parlays",headerCls:"medal-sgp",bodyCls:"medal-sgp-body",bets:filtered.filter(b=>b.market==="sgp"&&b.type==="medal")},
    {key:"futures",label:"ü•á Medal Futures",headerCls:"medal-futures",bodyCls:"medal-futures-body",bets:filtered.filter(b=>b.market==="futures")},
  ].filter(s=>s.bets.length>0);

  const container=document.getElementById("sectionsContainer");
  container.innerHTML=sections.map(sec=>{
    const isCollapsed=collapsedSections.has(sec.key);
    const wonCount=sec.bets.filter(b=>b.status==="won").length;
    const liveCount=sec.bets.filter(b=>b.status==="active"||b.status==="live").length;
    const statusSummary=[];
    if(liveCount)statusSummary.push(`<span style="color:var(--teal)">${liveCount} live</span>`);
    if(wonCount)statusSummary.push(`<span style="color:var(--win)">${wonCount} won</span>`);

    return`<div class="section">
      <div class="section-header ${sec.headerCls}" onclick="toggleSection('${sec.key}')">
        <div class="section-title">
          ${sec.label} <span class="section-count">${sec.bets.length}</span>
          ${statusSummary.length?`<span style="font-size:.7em;font-family:DM Sans;font-weight:500;margin-left:6px">${statusSummary.join(" ¬∑ ")}</span>`:""}
        </div>
        <div class="section-controls">
          <button class="section-btn" onclick="event.stopPropagation();expandAllInSection('${sec.key}',${JSON.stringify(sec.bets.map(b=>b.id))})">‚äû All</button>
          <button class="section-btn" onclick="event.stopPropagation();collapseAllInSection(${JSON.stringify(sec.bets.map(b=>b.id))})">‚äü All</button>
          <span class="section-toggle ${isCollapsed?"collapsed":""}">‚ñº</span>
        </div>
      </div>
      <div class="section-body ${sec.bodyCls} ${isCollapsed?"collapsed":""}">
        <div class="bets-grid">${sec.bets.map(renderBetCard).join("")}</div>
      </div>
    </div>`;
  }).join("");

  renderSummary();
}

function renderBetCard(b){
  const isExpanded=expandedBets.has(b.id);
  const cardClass=b.status==="won"?"won":b.status==="lost"?"lost":b.status==="dead"?"dead":"";
  const hasLegs=b.legs&&b.legs.length>0;
  const ring=hasLegs?progressRingSVG(b):"";
  const expandIcon=hasLegs?`<span style="color:var(--text3);font-size:1em;margin-left:6px">${isExpanded?"‚ñ≤":"‚ñº"}</span>`:"";
  return`<div class="bet-card ${cardClass}">
    <div class="bet-header" ${hasLegs?`onclick="toggleBet('${b.id}')"`:""}  style="${hasLegs?"cursor:pointer":"cursor:default"}">
      <div class="bet-left">
        ${ring}
        <div class="bet-info">
          <div class="bet-title">${b.pick}</div>
          <div class="bet-meta">
            <span>${b.event}</span>
            <span style="background:var(--surface2);padding:1px 6px;border-radius:3px;font-size:.9em">${getMarketLabel(b.market)}</span>
            ${getBadge(b)}
            ${b.eventDate?`<span style="color:var(--text3);font-size:.85em">üìÖ ${b.eventDate}</span>`:""}
            ${expandIcon}
          </div>
        </div>
      </div>
      <div class="bet-right">
        <div class="bet-odds">+${oddsNum(b.odds).toLocaleString()}</div>
        <div class="bet-payout">$${b.wager.toFixed(2)} ‚Üí $${b.payout.toFixed(2)}</div>
      </div>
    </div>
    ${hasLegs?`<div class="bet-detail ${isExpanded?"open":""}">
      ${b.deadReason?`<div class="dead-reason">‚ò† ${b.deadReason}</div>`:""}
      ${getGameWidget(b)}
      ${renderLegsDetail(b)}
    </div>`:""}
    ${!hasLegs&&b.result?`<div style="padding:0 14px 10px;font-size:.78em;color:var(--text2)">Result: ${b.result}</div>`:""}
  </div>`;
}

// ===== SECTION CONTROLS =====
function toggleSection(key){
  if(collapsedSections.has(key))collapsedSections.delete(key);
  else collapsedSections.add(key);
  renderAll();
}
function toggleBet(id){
  if(expandedBets.has(id))expandedBets.delete(id);
  else expandedBets.add(id);
  renderAll();
}
function expandAllInSection(key,ids){
  ids.forEach(id=>expandedBets.add(id));
  renderAll();
}
function collapseAllInSection(ids){
  ids.forEach(id=>expandedBets.delete(id));
  renderAll();
}

// ===== FILTER CONTROLS =====
function setFilter(f,btn){
  activeFilter=f;
  document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  renderAll();
}
function applyFilters(){
  searchText=document.getElementById("searchBox").value;
  renderAll();
}
function resetAll(){
  activeFilter="active";searchText="";
  document.getElementById("searchBox").value="";
  document.getElementById("sortSelect").value="status";
  expandedBets.clear();collapsedSections.clear();
  document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
  document.querySelector('[data-filter="active"]').classList.add("active");
  document.getElementById("analyticsPanel").classList.remove("show");
  renderAll();
}

// ===== ANALYTICS =====
function toggleAnalytics(){
  const panel=document.getElementById("analyticsPanel");
  panel.classList.toggle("show");
  if(panel.classList.contains("show"))renderAnalytics();
}
function renderAnalytics(){
  const panel=document.getElementById("analyticsGrid");
  // Win rate by market
  const markets={};
  BETS.forEach(b=>{
    const m=getMarketLabel(b.market);
    if(!markets[m])markets[m]={w:0,l:0,wager:0,returned:0};
    if(b.status==="won"){markets[m].w++;markets[m].returned+=b.payout}
    if(b.status==="lost"||b.status==="dead")markets[m].l++;
    markets[m].wager+=b.wager;
  });
  let winRateHtml='<div class="analytics-card"><h3>Win Rate by Market</h3>';
  Object.entries(markets).forEach(([m,d])=>{
    const total=d.w+d.l;if(!total)return;
    const rate=(d.w/total*100).toFixed(0);
    const roi=((d.returned-d.wager)/d.wager*100).toFixed(0);
    winRateHtml+=`<div style="display:flex;justify-content:space-between;padding:4px 0;font-size:.8em;border-bottom:1px solid var(--border)">
      <span>${m}</span><span>${d.w}W-${d.l}L (${rate}%)</span><span style="color:${parseInt(roi)>=0?"var(--win)":"var(--lose)"}">ROI: ${roi}%</span></div>`;
  });
  winRateHtml+='</div>';

  // Player Exposure
  const playerMap={};
  BETS.filter(b=>b.legs).forEach(b=>{
    b.legs.forEach(l=>{
      if(!l.player)return;
      if(!playerMap[l.player])playerMap[l.player]={count:0,payout:0};
      playerMap[l.player].count++;playerMap[l.player].payout+=b.payout;
    });
  });
  const topPlayers=Object.entries(playerMap).sort((a,b)=>b[1].count-a[1].count).slice(0,10);
  const maxCount=topPlayers[0]?.[1]?.count||1;
  let exposureHtml='<div class="analytics-card"><h3>üë§ Player Exposure</h3>';
  topPlayers.forEach(([name,d])=>{
    const jersey=JERSEYS[name]?`<span style="color:var(--teal)">${JERSEYS[name]}</span> `:"";
    exposureHtml+=`<div style="display:flex;align-items:center;gap:8px;padding:4px 0;font-size:.8em">
      <span style="min-width:140px">${jersey}${name}</span>
      <div class="exposure-bar-bg"><div class="exposure-bar-fill" style="width:${d.count/maxCount*100}%"></div></div>
      <span style="min-width:80px;text-align:right;color:var(--text2)">${d.count} legs ¬∑ $${d.payout.toFixed(0)}</span></div>`;
  });
  exposureHtml+='</div>';

  // Top Longshots
  let longshotHtml='<div class="analytics-card"><h3>üíé Top Longshots (Alive)</h3>';
  const alive=[...BETS].filter(b=>b.status!=="lost"&&b.status!=="dead").sort((a,b)=>b.payout-a.payout).slice(0,8);
  alive.forEach((b,i)=>{
    longshotHtml+=`<div class="longshot-row">
      <div style="display:flex;align-items:center;gap:8px">
        <span class="longshot-rank">#${i+1}</span>
        <div><div style="font-size:.8em;font-weight:600;color:var(--text)">${b.pick.substring(0,40)}${b.pick.length>40?"...":""}</div>
          <div style="font-size:.65em;color:var(--text3)">${b.event} ¬∑ +${oddsNum(b.odds).toLocaleString()}</div></div>
      </div>
      <span class="longshot-payout">$${b.payout.toFixed(2)}</span>
    </div>`;
  });
  longshotHtml+='</div>';

  panel.innerHTML=winRateHtml+exposureHtml+longshotHtml;
}

// ===== REFRESH =====
async function refreshData(){
  const btn=document.getElementById("refreshBtn");
  btn.textContent="‚è≥ Loading...";btn.disabled=true;
  try{
    await fetchHockeyScores();
    updateLegStatuses();
    renderAll();
    const now=new Date();
    document.getElementById("lastUpdated").textContent=`Last updated: ${now.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",timeZone:"America/New_York"})} ET`;
  }catch(e){console.error("Refresh error:",e)}
  btn.textContent="‚Üª REFRESH";btn.disabled=false;
}

function toggleAutoRefresh(){
  const btn=document.getElementById("autoToggle");
  if(autoRefreshInterval){
    clearInterval(autoRefreshInterval);autoRefreshInterval=null;
    btn.classList.remove("on");btn.textContent="Auto: OFF";
  }else{
    autoRefreshInterval=setInterval(refreshData,45000);
    btn.classList.add("on");btn.textContent="Auto: ON (45s)";
  }
}

// ===== ADD BET =====
function showAddModal(){document.getElementById("addModal").classList.add("show")}
function hideAddModal(){document.getElementById("addModal").classList.remove("show")}
function addBet(){
  const ev=document.getElementById("mEvent").value;
  const type=document.getElementById("mType").value;
  const market=document.getElementById("mMarket").value;
  const pick=document.getElementById("mPick").value;
  const odds=document.getElementById("mOdds").value;
  const wager=parseFloat(document.getElementById("mWager").value)||0.10;
  if(!pick||!odds){alert("Pick and Odds required");return}
  const payout=wager*(1+oddsNum(odds)/100);
  BETS.push({id:"u"+Date.now(),type,status:type==="medal"?"pending":"active",event:ev,market,pick,odds,wager,payout});
  // Save to localStorage
  const userBets=JSON.parse(localStorage.getItem("olympicsUserBets")||"[]");
  userBets.push({type,event:ev,market,pick,odds,wager,payout,status:type==="medal"?"pending":"active"});
  localStorage.setItem("olympicsUserBets",JSON.stringify(userBets));
  hideAddModal();renderAll();
}

// Load user-added bets from localStorage
function loadUserBets(){
  try{
    const saved=JSON.parse(localStorage.getItem("olympicsUserBets")||"[]");
    saved.forEach((b,i)=>{
      BETS.push({id:"u"+i,...b});
    });
  }catch(e){}
}

// ===== INIT =====
(async function(){
  loadUserBets();
  document.getElementById("autoToggle").textContent="Auto: OFF";
  await fetchHockeyScores();
  updateLegStatuses();
  renderAll();
  const now=new Date();
  document.getElementById("lastUpdated").textContent=`Last updated: ${now.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",timeZone:"America/New_York"})} ET`;
})();
</script>
</body>
</html>
